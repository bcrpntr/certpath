<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
<title>CertPath</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=Syne:wght@400;600;700;800&family=JetBrains+Mono:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
:root {
  --bg:#040608;--s1:#080c10;--s2:#0c1218;--s3:#101820;--s4:#141e28;
  --w1:#192334;--w2:#1f2c40;--w3:#26374e;--w4:#30455e;
  --d1:#3d546e;--d2:#567290;--d3:#7a9ab8;--d4:#a8c4dc;--d5:#d0e4f4;

  --teal:#00e5b0;--teal2:#00b88a;--teald:#00e5b010;--tealb:#00e5b025;
  --gold:#f0c040;--goldd:#f0c04010;--goldb:#f0c04028;
  --red:#ff4560;--redd:#ff456010;--redb:#ff456028;
  --violet:#b388ff;--viold:#b388ff10;--violb:#b388ff28;
  --amber:#ffb347;--amberd:#ffb34710;--amberb:#ffb34728;
  --sky:#5eb8ff;--skyd:#5eb8ff10;--skyb:#5eb8ff28;
  --mint:#4cffb8;
  --coral:#ff6b6b;

  --mono:'JetBrains Mono',monospace;
  --sans:'Syne',sans-serif;

  --mob-nav:56px;
  --hdr:48px;
  --r:10px;--r-sm:6px;--r-xs:4px;
}

*,*::before,*::after{box-sizing:border-box;margin:0;padding:0}
html{height:100%;-webkit-tap-highlight-color:transparent}
body{height:100%;background:var(--bg);color:var(--d5);font-family:var(--sans);font-size:14px;line-height:1.5;overflow:hidden;-webkit-font-smoothing:antialiased}
#root{height:100%;display:flex;flex-direction:column}

::-webkit-scrollbar{width:2px;height:2px}
::-webkit-scrollbar-track{background:transparent}
::-webkit-scrollbar-thumb{background:var(--w3);border-radius:2px}

input,select,button,textarea{font-family:inherit;-webkit-appearance:none;appearance:none}
button{cursor:pointer;touch-action:manipulation}

/* ‚îÄ‚îÄ SHELL ‚îÄ‚îÄ */
.app{display:flex;flex-direction:column;height:100%;overflow:hidden}
.hdr{
  display:flex;align-items:center;padding:0 16px;
  height:var(--hdr);flex-shrink:0;
  background:var(--s1);border-bottom:1px solid var(--w1);
  gap:10px;z-index:50;position:relative;
}
.logo{font-family:var(--mono);font-size:13px;font-weight:600;color:var(--teal);letter-spacing:-1px;flex-shrink:0}
.logo-v{color:var(--d1);font-size:9px;font-weight:300;margin-left:3px}

/* desktop nav in header */
.desk-nav{display:flex;flex:1;overflow-x:auto;gap:0}
.desk-nav::-webkit-scrollbar{display:none}
.dnav-btn{
  padding:0 12px;height:var(--hdr);
  background:transparent;border:none;
  font-family:var(--mono);font-size:9px;font-weight:600;
  color:var(--d1);letter-spacing:.8px;text-transform:uppercase;
  white-space:nowrap;position:relative;flex-shrink:0;
  transition:color .12s;
}
.dnav-btn::after{content:'';position:absolute;bottom:0;left:10px;right:10px;height:2px;background:var(--teal);transform:scaleX(0);transition:transform .15s;border-radius:1px}
.dnav-btn:hover{color:var(--d3)}
.dnav-btn.on{color:var(--teal)}
.dnav-btn.on::after{transform:scaleX(1)}
.npill{display:inline-flex;align-items:center;justify-content:center;width:14px;height:14px;border-radius:50%;font-size:8px;font-weight:800;margin-left:3px;vertical-align:middle}

.hdr-right{margin-left:auto;display:flex;align-items:center;gap:10px;flex-shrink:0}
.hdr-stat{font-family:var(--mono);font-size:9px;color:var(--d1);white-space:nowrap}

/* ‚îÄ‚îÄ CONTENT AREA ‚îÄ‚îÄ */
.body-wrap{flex:1;display:flex;overflow:hidden;position:relative}
.sidebar{
  width:272px;flex-shrink:0;
  background:var(--s1);border-right:1px solid var(--w1);
  display:flex;flex-direction:column;overflow:hidden;
}
.content{flex:1;overflow-y:auto;position:relative}
.content-pad{padding:18px 20px;min-height:100%}

/* ‚îÄ‚îÄ MOBILE BOTTOM NAV ‚îÄ‚îÄ */
.mob-nav{
  position:fixed;bottom:0;left:0;right:0;
  height:var(--mob-nav);z-index:100;
  background:var(--s1);border-top:1px solid var(--w1);
  flex-direction:row;
  overflow-x:auto;overflow-y:hidden;
  -webkit-overflow-scrolling:touch;
  padding-bottom:env(safe-area-inset-bottom,0px);
  /* shown/hidden via media query below */
}
.mob-nav::-webkit-scrollbar{display:none}
.mob-btn{
  display:flex;flex-direction:column;align-items:center;justify-content:center;
  gap:3px;padding:4px 0;
  min-width:52px;flex:1;
  background:transparent;border:none;
  font-family:var(--mono);font-size:8px;color:var(--d1);
  transition:color .12s;position:relative;
  touch-action:manipulation;
}
.mob-btn.on{color:var(--teal)}
.mob-icon{font-size:17px;line-height:1}
.mob-label{font-size:6.5px;letter-spacing:.3px;text-transform:uppercase;white-space:nowrap}
.mob-badge{
  position:absolute;top:4px;right:calc(50% - 16px);
  width:13px;height:13px;border-radius:50%;
  font-size:7px;font-weight:800;
  display:flex;align-items:center;justify-content:center;
}

/* sidebar stats */
.sb-sect{padding:14px;border-bottom:1px solid var(--w1)}
.sb-lbl{font-family:var(--mono);font-size:7px;font-weight:600;color:var(--d1);text-transform:uppercase;letter-spacing:1.5px;margin-bottom:8px}
.ring-wrap{display:flex;align-items:center;gap:12px;margin-bottom:10px}
.ring-box{position:relative;width:60px;height:60px;flex-shrink:0}
.ring-inner{position:absolute;inset:0;display:flex;flex-direction:column;align-items:center;justify-content:center}
.ring-pct{font-family:var(--mono);font-size:12px;font-weight:700;line-height:1}
.ring-sub{font-family:var(--mono);font-size:6px;color:var(--d1);margin-top:1px}
.qgrid{display:grid;grid-template-columns:1fr 1fr;gap:5px}
.qcell{background:var(--s2);border:1px solid var(--w1);border-radius:var(--r-sm);padding:7px 9px}
.qval{font-family:var(--mono);font-size:16px;font-weight:700;line-height:1}
.qlbl{font-family:var(--mono);font-size:7px;color:var(--d1);margin-top:2px;text-transform:uppercase;letter-spacing:.3px}

/* mini list */
.mc{display:flex;align-items:center;gap:7px;padding:6px 0;border-bottom:1px solid var(--w1);cursor:pointer;transition:all .1s}
.mc:last-child{border-bottom:none}
.mc:hover,.mc:active{background:var(--s2);margin:0 -14px;padding-left:14px;padding-right:14px}
.mc-dot{width:5px;height:5px;border-radius:50%;flex-shrink:0}
.mc-name{font-size:11px;color:var(--d4);flex:1;min-width:0;overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.mc-days{font-family:var(--mono);font-size:8px;flex-shrink:0}

.add-btn{
  display:flex;align-items:center;justify-content:center;gap:6px;
  margin:10px 14px;padding:9px;
  background:var(--teald);border:1px dashed var(--tealb);border-radius:var(--r-sm);
  color:var(--teal);font-family:var(--mono);font-size:10px;font-weight:600;
  transition:all .15s;
}
.add-btn:hover,.add-btn:active{background:var(--tealb)}

/* ‚îÄ‚îÄ OPTIMIZER DRAWER ‚îÄ‚îÄ */
.drawer{
  flex-shrink:0;background:var(--s1);border-top:1px solid var(--w1);
  display:flex;flex-direction:column;overflow:hidden;
  transition:height .2s ease;
}
.drawer-hdr{
  display:flex;align-items:center;padding:0 16px;height:36px;
  cursor:pointer;border-bottom:1px solid var(--w1);flex-shrink:0;gap:10px;
}
.drawer-hdr:hover,.drawer-hdr:active{background:var(--s2)}
.drawer-title{font-family:var(--mono);font-size:9px;font-weight:600;color:var(--teal);letter-spacing:.8px;flex:1}
.drawer-cost{font-family:var(--mono);font-size:12px;font-weight:700}
.drawer-toggle{font-family:var(--mono);font-size:10px;color:var(--d1)}
.drawer-body{flex:1;overflow-x:auto;overflow-y:hidden;padding:10px 14px;display:flex;gap:8px;align-items:flex-start}

.ds{flex-shrink:0;width:190px;background:var(--s2);border:1px solid var(--w1);border-radius:var(--r-sm);padding:10px;position:relative;overflow:hidden}
.ds::before{content:'';position:absolute;top:0;left:0;right:0;height:2px}
.ds.t-free::before,.ds.t-auto::before{background:var(--teal)}
.ds.t-ce::before{background:var(--sky)}
.ds.t-exam::before{background:var(--violet)}
.ds.t-newcert::before{background:var(--amber)}
.ds-typ{font-family:var(--mono);font-size:7px;font-weight:700;letter-spacing:1px;text-transform:uppercase;margin-bottom:3px}
.ds-title{font-size:11px;font-weight:600;line-height:1.3;margin-bottom:4px;color:var(--d5)}
.ds-cost{font-family:var(--mono);font-size:10px;font-weight:700}
.ds-chips{display:flex;flex-wrap:wrap;gap:2px;margin-top:5px}
.ds-chip{font-family:var(--mono);font-size:7px;padding:1px 4px;border-radius:2px;background:var(--teald);color:var(--teal)}
.drawer-empty{display:flex;align-items:center;justify-content:center;width:100%;color:var(--d1);font-family:var(--mono);font-size:10px;text-align:center;line-height:1.6}

/* ‚îÄ‚îÄ URGENCY BANNER ‚îÄ‚îÄ */
.urgency{
  display:flex;align-items:center;gap:10px;
  padding:8px 14px;flex-shrink:0;
  background:linear-gradient(90deg,var(--redb),var(--goldb));
  border-bottom:1px solid var(--redb);
  font-family:var(--mono);font-size:10px;
}
.urgency-dot{width:6px;height:6px;border-radius:50%;background:var(--red);flex-shrink:0;animation:pulse 1.5s infinite}
@keyframes pulse{0%,100%{opacity:1}50%{opacity:.3}}

/* ‚îÄ‚îÄ BUTTONS ‚îÄ‚îÄ */
.btn{display:inline-flex;align-items:center;gap:5px;padding:6px 12px;border-radius:var(--r-xs);font-family:var(--mono);font-size:10px;font-weight:600;border:none;cursor:pointer;transition:all .12s;white-space:nowrap;letter-spacing:.3px;touch-action:manipulation}
.btn-teal{background:var(--teal);color:var(--bg);font-weight:700}
.btn-teal:hover,.btn-teal:active{background:var(--mint)}
.btn-ghost{background:transparent;color:var(--d2);border:1px solid var(--w2)}
.btn-ghost:hover,.btn-ghost:active{color:var(--d4);border-color:var(--w3)}
.btn-viol{background:var(--viold);color:var(--violet);border:1px solid var(--violb)}
.btn-viol:hover,.btn-viol:active{background:var(--violb)}
.btn-amber{background:var(--amberd);color:var(--amber);border:1px solid var(--amberb)}
.btn-amber:hover,.btn-amber:active{background:var(--amberb)}
.btn-red{background:transparent;color:var(--red);border:1px solid var(--redb)}
.btn-red:hover,.btn-red:active{background:var(--redd)}
.btn-sky{background:var(--skyd);color:var(--sky);border:1px solid var(--skyb)}
.btn-sky:hover,.btn-sky:active{background:var(--skyb)}
.btn-gold{background:var(--goldd);color:var(--gold);border:1px solid var(--goldb)}
.btn-gold:hover,.btn-gold:active{background:var(--goldb)}
.btn-sm{padding:3px 8px;font-size:9px}
.btn-xs{padding:2px 6px;font-size:8px}
.btn:disabled{opacity:.3;cursor:not-allowed}

/* ‚îÄ‚îÄ CARDS ‚îÄ‚îÄ */
.card{background:var(--s2);border:1px solid var(--w1);border-radius:var(--r);padding:15px}
.card2{background:var(--s3);border:1px solid var(--w1);border-radius:var(--r-sm);padding:11px}
.sh{display:flex;align-items:center;justify-content:space-between;margin-bottom:12px;flex-wrap:wrap;gap:8px}
.slbl{font-family:var(--mono);font-size:8px;font-weight:600;color:var(--d1);text-transform:uppercase;letter-spacing:1.2px}

/* ‚îÄ‚îÄ CERT CARDS ‚îÄ‚îÄ */
.cgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(240px,1fr));gap:9px}
.cc{
  background:var(--s2);border:1px solid var(--w1);border-radius:var(--r);
  padding:13px;position:relative;overflow:hidden;
  transition:border-color .15s,transform .15s;
  cursor:pointer;
}
.cc:hover{border-color:var(--w2);transform:translateY(-1px)}
.cc:active{transform:scale(.98)}
.cc::before{content:'';position:absolute;top:0;left:0;right:0;height:2px}
.cc.s-c::before{background:var(--teal)}
.cc.s-e::before{background:var(--gold)}
.cc.s-x::before{background:var(--red)}
.cc.s-u::before{background:var(--w3)}
.cc.s-t::before{background:var(--violet)}
.cc.s-s::before{background:var(--violet);opacity:.6}
.cc-head{display:flex;justify-content:space-between;align-items:flex-start;margin-bottom:9px}
.cc-name{font-size:13px;font-weight:700;color:var(--d5);line-height:1.2}
.cc-vendor{font-family:var(--mono);font-size:8px;color:var(--d1);text-transform:uppercase;letter-spacing:.5px;margin-top:2px}
.cc-tier{font-family:var(--mono);font-size:8px;margin-top:2px}
.cc-meta{display:flex;flex-direction:column;gap:3px}
.cc-row{display:flex;justify-content:space-between;align-items:center}
.cc-key{font-family:var(--mono);font-size:8px;color:var(--d1)}
.cc-val{font-family:var(--mono);font-size:8px}
.cc-bar{height:2px;background:var(--w1);border-radius:1px;overflow:hidden;margin-top:7px}
.cc-fill{height:100%;border-radius:1px;transition:width .4s}
.cc-xg{font-family:var(--mono);font-size:8px;color:var(--d1);margin-top:6px;padding-top:5px;border-top:1px solid var(--w1)}

/* ‚îÄ‚îÄ ARC RING ‚îÄ‚îÄ */
.arc{position:relative;flex-shrink:0}
.arc-lbl{font-family:var(--mono);font-size:7px;text-align:center;margin-top:1px}

/* ‚îÄ‚îÄ PILLS ‚îÄ‚îÄ */
.pill{display:inline-flex;align-items:center;padding:1px 5px;border-radius:2px;font-family:var(--mono);font-size:7px;font-weight:700;letter-spacing:.5px}
.pk{background:#00e5b012;color:var(--teal)}
.py{background:var(--goldd);color:var(--gold)}
.pr{background:var(--redd);color:var(--red)}
.pg{background:var(--w1);color:var(--d1)}
.pv{background:var(--viold);color:var(--violet)}
.pa{background:var(--amberd);color:var(--amber)}
.ps{background:var(--skyd);color:var(--sky)}

/* ‚îÄ‚îÄ TAGS ‚îÄ‚îÄ */
.tag{display:inline-block;padding:1px 5px;border-radius:2px;font-family:var(--mono);font-size:8px;margin:1px;letter-spacing:.2px}
.tteal{background:var(--teald);color:var(--teal);border:1px solid var(--tealb)}
.tviolet{background:var(--viold);color:var(--violet);border:1px solid var(--violb)}
.tamber{background:var(--amberd);color:var(--amber);border:1px solid var(--amberb)}
.tgold{background:var(--goldd);color:var(--gold);border:1px solid var(--goldb)}
.tsky{background:var(--skyd);color:var(--sky);border:1px solid var(--skyb)}
.tgrey{background:var(--w1);color:var(--d2);border:1px solid var(--w2)}
.tred{background:var(--redd);color:var(--red);border:1px solid var(--redb)}

/* ‚îÄ‚îÄ MODAL ‚îÄ‚îÄ */
.ov{position:fixed;inset:0;background:rgba(0,0,0,.8);z-index:500;display:flex;align-items:flex-end;justify-content:center;backdrop-filter:blur(6px)}
@media(min-width:640px){.ov{align-items:center}}
.modal{
  background:var(--s2);border:1px solid var(--w2);
  width:100%;max-width:540px;
  border-radius:var(--r) var(--r) 0 0;
  padding:20px;max-height:90vh;overflow-y:auto;
}
@media(min-width:640px){.modal{border-radius:var(--r);max-height:88vh}}
.modal-handle{width:36px;height:3px;background:var(--w2);border-radius:2px;margin:0 auto 16px}
@media(min-width:640px){.modal-handle{display:none}}
.modal-title{font-size:15px;font-weight:700;margin-bottom:16px}
.modal-foot{display:flex;gap:8px;justify-content:flex-end;margin-top:16px;padding-top:12px;border-top:1px solid var(--w1)}
.fg{margin-bottom:11px}
.fl{display:block;font-family:var(--mono);font-size:8px;color:var(--d2);margin-bottom:4px;text-transform:uppercase;letter-spacing:.5px}
.fi{width:100%;padding:8px 10px;background:var(--s3);border:1px solid var(--w2);border-radius:var(--r-xs);color:var(--d5);font-family:var(--mono);font-size:11px;outline:none;transition:border-color .15s;-webkit-appearance:none}
.fi:focus{border-color:var(--teal)}
.fsel{width:100%;padding:8px 10px;background:var(--s3);border:1px solid var(--w2);border-radius:var(--r-xs);color:var(--d5);font-family:var(--mono);font-size:11px;outline:none;cursor:pointer;-webkit-appearance:none;appearance:none}
.fsel:focus{border-color:var(--teal)}

/* ‚îÄ‚îÄ BANNERS ‚îÄ‚îÄ */
.ban{border-radius:var(--r-sm);padding:8px 11px;font-size:11px;line-height:1.6;margin-bottom:11px}
.ban-c{background:var(--teald);border:1px solid var(--tealb);color:var(--d3)}
.ban-y{background:var(--goldd);border:1px solid var(--goldb);color:var(--gold)}
.ban-ok{background:#00e5b00c;border:1px solid var(--tealb);color:var(--teal)}
.ban-v{background:var(--viold);border:1px solid var(--violb);color:var(--violet)}
.ban-a{background:var(--amberd);border:1px solid var(--amberb);color:var(--amber)}
.ban-r{background:var(--redd);border:1px solid var(--redb);color:var(--red)}
.ban-s{background:var(--skyd);border:1px solid var(--skyb);color:var(--sky)}

/* ‚îÄ‚îÄ REC CARDS ‚îÄ‚îÄ */
.rec{
  display:flex;gap:12px;padding:13px;
  background:var(--s2);border:1px solid var(--w1);border-radius:var(--r);
  margin-bottom:8px;position:relative;overflow:hidden;
  transition:border-color .15s;
}
.rec::before{content:'';position:absolute;top:0;left:0;bottom:0;width:3px;background:var(--rank-color,var(--w2))}
.rec-rank{font-family:var(--mono);font-size:20px;font-weight:700;color:var(--rank-color,var(--w3));line-height:1;flex-shrink:0;width:24px;text-align:center;padding-top:1px}
.rec-body{flex:1;min-width:0}
.rec-name{font-size:13px;font-weight:700;margin-bottom:2px}
.rec-sub{font-family:var(--mono);font-size:9px;color:var(--d2);margin-bottom:6px;line-height:1.4}
.rec-tags{display:flex;flex-wrap:wrap;gap:3px;margin-bottom:6px}
.rec-stats{display:flex;gap:12px;flex-wrap:wrap}
.rec-stat{font-family:var(--mono);font-size:8px;color:var(--d1)}
.rec-stat span{color:var(--d3)}
.rec-acts{display:flex;flex-direction:column;gap:4px;flex-shrink:0;justify-content:center}

/* ‚îÄ‚îÄ CASCADE ‚îÄ‚îÄ */
.casc{margin-top:9px;padding:9px 11px;background:var(--s3);border:1px solid var(--tealb);border-radius:var(--r-sm);animation:fin .15s ease}
@keyframes fin{from{opacity:0;transform:translateY(-3px)}to{opacity:1;transform:translateY(0)}}
.casc-lbl{font-family:var(--mono);font-size:7px;color:var(--teal);text-transform:uppercase;letter-spacing:1px;margin-bottom:6px}
.casc-row{display:flex;justify-content:space-between;align-items:baseline;padding:3px 0;border-bottom:1px solid var(--w1);font-family:var(--mono);font-size:9px}
.casc-row:last-child{border-bottom:none}

/* ‚îÄ‚îÄ PATH ‚îÄ‚îÄ */
.path-wrap{position:relative;padding-left:24px}
.path-wrap::before{content:'';position:absolute;left:8px;top:14px;bottom:14px;width:1px;background:var(--w2)}
.path-node{
  position:relative;display:flex;align-items:flex-start;gap:9px;
  padding:8px 10px;margin-bottom:5px;
  background:var(--s3);border:1px solid var(--w1);border-radius:var(--r-sm);
  transition:border-color .15s;
}
.path-node.goal{border-color:var(--violb);background:var(--viold)}
.path-dot{position:absolute;left:-19px;top:50%;transform:translateY(-50%);width:10px;height:10px;border-radius:50%;border:2px solid var(--w2);background:var(--bg)}
.path-dot.pgoal{border-color:var(--violet);background:var(--violet)}
.path-info{flex:1;min-width:0}
.path-name{font-size:12px;font-weight:700}
.path-sub{font-family:var(--mono);font-size:8px;color:var(--d1)}
.path-casc{font-family:var(--mono);font-size:8px;color:var(--teal);margin-top:3px}
.path-cost{font-family:var(--mono);font-size:11px;font-weight:700;color:var(--teal);flex-shrink:0}

/* ‚îÄ‚îÄ TRACK CARDS ‚îÄ‚îÄ */
.tgrid{display:grid;grid-template-columns:repeat(auto-fill,minmax(190px,1fr));gap:8px}
.tcard{
  padding:13px;background:var(--s2);border:1px solid var(--w1);border-radius:var(--r);
  cursor:pointer;transition:all .15s;position:relative;overflow:hidden;
}
.tcard:hover,.tcard:active{transform:translateY(-1px);border-color:var(--w2)}
.tcard.sel{border-color:var(--violb);background:var(--viold)}
.tcard-bar{position:absolute;bottom:0;left:0;right:0;height:2px}
.tcard-icon{font-size:20px;margin-bottom:7px}
.tcard-name{font-size:12px;font-weight:700;margin-bottom:3px;line-height:1.2}
.tcard-desc{font-size:10px;color:var(--d2);line-height:1.4;margin-bottom:6px}
.tcard-count{font-family:var(--mono);font-size:8px;color:var(--d1)}

/* ‚îÄ‚îÄ CROSS FLOW ‚îÄ‚îÄ */
.xrow{
  display:grid;grid-template-columns:1fr 28px 1fr 70px;
  align-items:center;gap:5px;
  padding:6px 9px;background:var(--s3);border:1px solid var(--w1);
  border-radius:var(--r-sm);margin-bottom:4px;
  font-family:var(--mono);font-size:9px;
  transition:border-color .15s;
}
.xrow.xa{border-color:var(--tealb)}
.xrow.xt{border-color:var(--amberb)}
.xarrow{text-align:center;color:var(--d1)}
.xa .xarrow{color:var(--teal)}
.xt .xarrow{color:var(--amber)}

/* ‚îÄ‚îÄ TIMELINE ‚îÄ‚îÄ */
.tlrow{display:grid;grid-template-columns:140px 1fr 50px;align-items:center;gap:8px;padding:5px 0;border-bottom:1px solid var(--w1)}
.tlbar{height:4px;background:var(--w1);border-radius:2px;overflow:hidden}
.tlfill{height:100%;border-radius:2px;transition:width .4s}
.tlname{font-size:10px;color:var(--d4);overflow:hidden;text-overflow:ellipsis;white-space:nowrap}
.tldays{font-family:var(--mono);font-size:8px;text-align:right}

/* ‚îÄ‚îÄ DOD OVERLAY ‚îÄ‚îÄ */
.dod-grid{display:grid;grid-template-columns:repeat(auto-fill,minmax(180px,1fr));gap:8px;margin-top:10px}
.dod-card{background:var(--s3);border:1px solid var(--w1);border-radius:var(--r-sm);padding:11px}
.dod-level{font-family:var(--mono);font-size:8px;font-weight:700;color:var(--d1);text-transform:uppercase;letter-spacing:1px;margin-bottom:8px}
.dod-cert-row{display:flex;align-items:center;justify-content:space-between;padding:4px 0;border-bottom:1px solid var(--w1);font-size:10px}
.dod-cert-row:last-child{border-bottom:none}

/* ‚îÄ‚îÄ NETWORK GRAPH ‚îÄ‚îÄ */
.graph-wrap{position:relative;background:var(--s2);border:1px solid var(--w1);border-radius:var(--r);overflow:hidden}
.graph-legend{display:flex;flex-wrap:wrap;gap:10px;padding:10px 14px;border-top:1px solid var(--w1)}
.gl-item{display:flex;align-items:center;gap:5px;font-family:var(--mono);font-size:8px;color:var(--d2)}
.gl-dot{width:8px;height:8px;border-radius:50%}

/* ‚îÄ‚îÄ POOL INSPECTOR ‚îÄ‚îÄ */
.pool-panel{background:var(--s3);border:1px solid var(--w1);border-radius:var(--r-sm);padding:12px;margin-top:10px;animation:fin .15s}
.pool-row{display:flex;justify-content:space-between;align-items:center;padding:5px 0;border-bottom:1px solid var(--w1);font-size:10px}
.pool-row:last-child{border-bottom:none}
.pool-source{font-family:var(--mono);font-size:9px;color:var(--d3)}
.pool-cr{font-family:var(--mono);font-size:9px;color:var(--teal);font-weight:700}

/* ‚îÄ‚îÄ MISC ‚îÄ‚îÄ */
.empty{display:flex;flex-direction:column;align-items:center;justify-content:center;padding:48px 20px;gap:10px;color:var(--d1)}
.empty-icon{font-size:32px;opacity:.5}
.empty-msg{font-family:var(--mono);font-size:10px;text-align:center;line-height:1.8}
.divider{border:none;border-top:1px solid var(--w1);margin:16px 0}
.flex{display:flex}.fac{align-items:center}.fw{flex-wrap:wrap}.g4{gap:4px}.g6{gap:6px}.g8{gap:8px}.g10{gap:10px}.g12{gap:12px}.g16{gap:16px}
.mono{font-family:var(--mono)}.sm{font-size:12px}.xs{font-size:10px}.tiny{font-size:8px}
.ct{color:var(--teal)}.cy{color:var(--gold)}.cr{color:var(--red)}.cv{color:var(--violet)}.ca{color:var(--amber)}.cs{color:var(--sky)}.cd{color:var(--d1)}.cm{color:var(--d2)}.cp{color:var(--d3)}.cn{color:var(--d5)}
.w100{width:100%}.mt8{margin-top:8px}.mt12{margin-top:12px}.mt16{margin-top:16px}.mb8{margin-bottom:8px}.mb12{margin-bottom:12px}.mb16{margin-bottom:16px}
.bold{font-weight:700}.sb{justify-content:space-between}
.slider{width:100%;accent-color:var(--teal)}

/* ‚îÄ‚îÄ RESPONSIVE ‚îÄ‚îÄ */
@media(max-width:768px){
  .sidebar{display:none}
  .desk-nav{display:none}
  .hdr-right .hdr-stat{display:none}
  .hdr{padding:0 12px}
  .mob-nav{display:flex}
  .body-wrap{padding-bottom:var(--mob-nav)}
  .content-pad{padding-bottom:calc(var(--mob-nav) + 70px)}
  .drawer{display:none}
  .mob-add-btn{display:flex !important}
  .cgrid{grid-template-columns:1fr 1fr}
  .tgrid{grid-template-columns:1fr 1fr}
  .content-pad{padding:12px 14px}
  .tlrow{grid-template-columns:110px 1fr 40px}
  .xrow{grid-template-columns:1fr 20px 1fr 60px;font-size:8px}
}
@media(max-width:480px){
  .cgrid{grid-template-columns:1fr}
  .tgrid{grid-template-columns:1fr}
  .cc-name{font-size:12px}
  .dod-grid{grid-template-columns:1fr}
  .dod-grid{grid-template-columns:repeat(2,1fr)}
}
@media(min-width:769px){
  .mob-nav{display:none}
  .body-wrap{padding-bottom:0}
  .mob-add-btn{display:none !important}
}
/* Mobile FAB */
.mob-add-btn{
  display:none;
  position:fixed;bottom:calc(var(--mob-nav) + 14px);right:16px;z-index:90;
  width:46px;height:46px;border-radius:50%;
  background:var(--teal);color:var(--bg);
  border:none;font-size:22px;font-weight:300;
  align-items:center;justify-content:center;
  box-shadow:0 4px 20px rgba(0,229,176,0.4);
  transition:transform .15s, box-shadow .15s;
}
.mob-add-btn:active{transform:scale(.93);box-shadow:0 2px 10px rgba(0,229,176,0.3)}
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useMemo, useCallback, useRef, memo } = React;

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// DATA
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const CERTS = [
  {id:'cpt-a',      v:'CompTIA',     t:1,n:'A+',                       cy:3, $:253,  pools:['cpt-core'],            ce:20,  xo:false,nx:false,pre:[],sat:[],d:6},
  {id:'cpt-net',    v:'CompTIA',     t:1,n:'Network+',                 cy:3, $:358,  pools:['cpt-core','cpt-net'],  ce:30,  xo:false,nx:false,pre:[],sat:[],d:7},
  {id:'cpt-sec',    v:'CompTIA',     t:2,n:'Security+',                cy:3, $:392,  pools:['cpt-core','cpt-sec'],  ce:50,  xo:false,nx:false,pre:[],sat:['cpt-a','cpt-net'],d:9,dod:'IAT-II'},
  {id:'cpt-linux',  v:'CompTIA',     t:1,n:'Linux+',                   cy:3, $:358,  pools:['cpt-core','cpt-net'],  ce:30,  xo:false,nx:false,pre:[],sat:[],d:6},
  {id:'cpt-cloud',  v:'CompTIA',     t:2,n:'Cloud+',                   cy:3, $:358,  pools:['cpt-core','cpt-net'],  ce:30,  xo:false,nx:false,pre:[],sat:[],d:6},
  {id:'cpt-cysa',   v:'CompTIA',     t:3,n:'CySA+',                    cy:3, $:392,  pools:['cpt-sec','cpt-adv'],   ce:60,  xo:false,nx:false,pre:['cpt-sec'],sat:['cpt-sec'],d:8,dod:'IAT-II'},
  {id:'cpt-pen',    v:'CompTIA',     t:3,n:'PenTest+',                 cy:3, $:392,  pools:['cpt-sec','cpt-adv'],   ce:60,  xo:false,nx:false,pre:['cpt-sec'],sat:['cpt-sec'],d:7},
  {id:'cpt-casp',   v:'CompTIA',     t:4,n:'CASP+',                    cy:3, $:494,  pools:['cpt-adv'],             ce:75,  xo:false,nx:false,pre:['cpt-sec'],sat:['cpt-sec','cpt-cysa','cpt-pen'],d:7,dod:'IAT-III'},
  {id:'isc-cc',     v:'ISC¬≤',        t:1,n:'CC',                       cy:3, $:0,    pools:['isc-cpe'],             ce:45,  xo:false,nx:false,pre:[],sat:[],d:6},
  {id:'isc-sscp',   v:'ISC¬≤',        t:2,n:'SSCP',                     cy:3, $:249,  pools:['isc-cpe'],             ce:60,  xo:false,nx:false,pre:[],sat:['isc-cc'],d:6,dod:'IAT-II'},
  {id:'isc-cissp',  v:'ISC¬≤',        t:4,n:'CISSP',                    cy:3, $:749,  pools:['isc-cpe'],             ce:120, xo:false,nx:false,pre:[],sat:['isc-sscp','isc-cc'],d:10,af:125,dod:'IAT-III'},
  {id:'isc-ccsp',   v:'ISC¬≤',        t:3,n:'CCSP',                     cy:3, $:599,  pools:['isc-cpe'],             ce:90,  xo:false,nx:false,pre:['isc-sscp'],sat:['isc-sscp','isc-cc'],d:8},
  {id:'isc-csslp',  v:'ISC¬≤',        t:3,n:'CSSLP',                    cy:3, $:599,  pools:['isc-cpe'],             ce:90,  xo:false,nx:false,pre:[],sat:[],d:6},
  {id:'isc-cgrc',   v:'ISC¬≤',        t:3,n:'CGRC',                     cy:3, $:599,  pools:['isc-cpe'],             ce:60,  xo:false,nx:false,pre:[],sat:[],d:6},
  {id:'isa-cisa',   v:'ISACA',       t:4,n:'CISA',                     cy:3, $:575,  pools:['isa-cpe'],             ce:120, xo:false,nx:false,pre:[],sat:[],d:8,af:85},
  {id:'isa-cism',   v:'ISACA',       t:4,n:'CISM',                     cy:3, $:575,  pools:['isa-cpe'],             ce:120, xo:false,nx:false,pre:[],sat:[],d:9,af:85},
  {id:'isa-crisc',  v:'ISACA',       t:4,n:'CRISC',                    cy:3, $:575,  pools:['isa-cpe'],             ce:120, xo:false,nx:false,pre:[],sat:[],d:8,af:85},
  {id:'isa-cdpse',  v:'ISACA',       t:3,n:'CDPSE',                    cy:3, $:575,  pools:['isa-cpe'],             ce:60,  xo:false,nx:false,pre:[],sat:[],d:6},
  {id:'ec-ceh',     v:'EC-Council',  t:2,n:'CEH',                      cy:3, $:550,  pools:['ec-ece'],              ce:120, xo:false,nx:false,pre:[],sat:[],d:7,dod:'IAT-II'},
  {id:'ec-cpent',   v:'EC-Council',  t:3,n:'CPENT',                    cy:3, $:999,  pools:['ec-ece'],              ce:120, xo:false,nx:false,pre:['ec-ceh'],sat:['ec-ceh'],d:6},
  {id:'ec-chfi',    v:'EC-Council',  t:3,n:'CHFI',                     cy:3, $:550,  pools:['ec-ece'],              ce:120, xo:false,nx:false,pre:[],sat:[],d:6},
  {id:'gc-gsec',    v:'GIAC',        t:2,n:'GSEC',                     cy:4, $:849,  pools:['gc-cpe'],              ce:36,  xo:false,nx:false,pre:[],sat:[],d:7},
  {id:'gc-gcih',    v:'GIAC',        t:3,n:'GCIH',                     cy:4, $:849,  pools:['gc-cpe'],              ce:36,  xo:false,nx:false,pre:[],sat:[],d:7},
  {id:'gc-gpen',    v:'GIAC',        t:3,n:'GPEN',                     cy:4, $:849,  pools:['gc-cpe'],              ce:36,  xo:false,nx:false,pre:[],sat:[],d:7},
  {id:'gc-gwapt',   v:'GIAC',        t:3,n:'GWAPT',                    cy:4, $:849,  pools:['gc-cpe'],              ce:36,  xo:false,nx:false,pre:[],sat:[],d:6},
  {id:'gc-gcia',    v:'GIAC',        t:3,n:'GCIA',                     cy:4, $:849,  pools:['gc-cpe'],              ce:36,  xo:false,nx:false,pre:[],sat:[],d:7},
  {id:'gc-gcfe',    v:'GIAC',        t:3,n:'GCFE',                     cy:4, $:849,  pools:['gc-cpe'],              ce:36,  xo:false,nx:false,pre:[],sat:[],d:6},
  {id:'aws-cp',     v:'AWS',         t:1,n:'Cloud Practitioner',       cy:3, $:100,  pools:[],                      ce:0,   xo:true, nx:false,pre:[],sat:[],d:7},
  {id:'aws-saa',    v:'AWS',         t:2,n:'SA Associate',             cy:3, $:300,  pools:[],                      ce:0,   xo:true, nx:false,pre:[],sat:['aws-cp'],d:9},
  {id:'aws-dev',    v:'AWS',         t:2,n:'Developer Associate',      cy:3, $:300,  pools:[],                      ce:0,   xo:true, nx:false,pre:[],sat:['aws-cp'],d:8},
  {id:'aws-saap',   v:'AWS',         t:3,n:'SA Professional',          cy:3, $:300,  pools:[],                      ce:0,   xo:true, nx:false,pre:['aws-saa'],sat:['aws-saa','aws-cp'],d:9},
  {id:'aws-dop',    v:'AWS',         t:3,n:'DevOps Engineer Pro',      cy:3, $:300,  pools:[],                      ce:0,   xo:true, nx:false,pre:['aws-dev'],sat:['aws-dev','aws-cp'],d:8},
  {id:'aws-sec',    v:'AWS',         t:3,n:'Security Specialty',       cy:3, $:300,  pools:[],                      ce:0,   xo:true, nx:false,pre:[],sat:[],d:9},
  {id:'az-900',     v:'Microsoft',   t:1,n:'AZ-900 Fundamentals',      cy:999,$:165, pools:[],                      ce:0,   xo:true, nx:true, pre:[],sat:[],d:7},
  {id:'az-104',     v:'Microsoft',   t:2,n:'AZ-104 Administrator',     cy:1, $:165,  pools:[],                      ce:0,   xo:true, nx:false,pre:[],sat:['az-900'],d:8},
  {id:'sc-200',     v:'Microsoft',   t:2,n:'SC-200 Security Ops',      cy:1, $:165,  pools:[],                      ce:0,   xo:true, nx:false,pre:[],sat:[],d:8},
  {id:'az-500',     v:'Microsoft',   t:3,n:'AZ-500 Security',          cy:1, $:165,  pools:[],                      ce:0,   xo:true, nx:false,pre:[],sat:['sc-200'],d:8},
  {id:'az-305',     v:'Microsoft',   t:3,n:'AZ-305 Architect',         cy:1, $:165,  pools:[],                      ce:0,   xo:true, nx:false,pre:['az-104'],sat:['az-104'],d:8},
  {id:'sc-900',     v:'Microsoft',   t:1,n:'SC-900 Security Fund.',    cy:999,$:165, pools:[],                      ce:0,   xo:true, nx:true, pre:[],sat:[],d:6},
  {id:'gcp-ace',    v:'Google Cloud',t:2,n:'Associate Cloud Eng.',     cy:2, $:200,  pools:[],                      ce:0,   xo:true, nx:false,pre:[],sat:[],d:7},
  {id:'gcp-pca',    v:'Google Cloud',t:3,n:'Pro Cloud Architect',      cy:2, $:200,  pools:[],                      ce:0,   xo:true, nx:false,pre:['gcp-ace'],sat:['gcp-ace'],d:8},
  {id:'gcp-sec',    v:'Google Cloud',t:3,n:'Pro Cloud Security',       cy:2, $:200,  pools:[],                      ce:0,   xo:true, nx:false,pre:[],sat:[],d:7},
  {id:'os-oscp',    v:'OffSec',      t:3,n:'OSCP',                     cy:999,$:1499,pools:[],                      ce:0,   xo:false,nx:true, pre:[],sat:[],d:9},
  {id:'os-osep',    v:'OffSec',      t:4,n:'OSEP',                     cy:999,$:1499,pools:[],                      ce:0,   xo:false,nx:true, pre:['os-oscp'],sat:['os-oscp'],d:7},
  {id:'os-oswp',    v:'OffSec',      t:3,n:'OSWP',                     cy:999,$:999, pools:[],                      ce:0,   xo:false,nx:true, pre:[],sat:[],d:6},
  {id:'cs-ccna',    v:'Cisco',       t:2,n:'CCNA',                     cy:3, $:330,  pools:[],                      ce:0,   xo:true, nx:false,pre:[],sat:[],d:8},
  {id:'cs-ccnpent', v:'Cisco',       t:3,n:'CCNP Enterprise',          cy:3, $:750,  pools:[],                      ce:0,   xo:true, nx:false,pre:['cs-ccna'],sat:['cs-ccna'],d:7},
  {id:'cs-ccnpsec', v:'Cisco',       t:3,n:'CCNP Security',            cy:3, $:750,  pools:[],                      ce:0,   xo:true, nx:false,pre:['cs-ccna'],sat:['cs-ccna'],d:7},
  {id:'cs-ccie',    v:'Cisco',       t:4,n:'CCIE',                     cy:3, $:1600, pools:[],                      ce:0,   xo:true, nx:false,pre:['cs-ccnpent'],sat:['cs-ccnpent','cs-ccnpsec','cs-ccna'],d:8},
  {id:'pm-pmp',     v:'PMI',         t:3,n:'PMP',                      cy:3, $:555,  pools:['pm-pdu'],              ce:60,  xo:false,nx:false,pre:[],sat:[],d:8,af:60},
  {id:'it-found',   v:'ITIL',        t:1,n:'ITIL 4 Foundation',        cy:999,$:385, pools:[],                      ce:0,   xo:false,nx:true, pre:[],sat:[],d:7},
  {id:'it-prac',    v:'ITIL',        t:3,n:'ITIL 4 Practitioner',      cy:3, $:550,  pools:[],                      ce:0,   xo:false,nx:false,pre:['it-found'],sat:['it-found'],d:6},
];

// DoD 8570 mappings
const DOD = {
  'IAT-I':  ['cpt-a','cpt-net','it-found'],
  'IAT-II': ['cpt-sec','cpt-cysa','ec-ceh','isc-sscp','gc-gsec'],
  'IAT-III':['cpt-casp','isc-cissp','gc-gsec'],
  'IAM-I':  ['isc-cissp','cpt-casp','isa-cism'],
  'IAM-II': ['isc-cissp','isa-cism','isa-cisa'],
  'IAM-III':['isc-cissp'],
};

const XG = [
  {from:'isc-cissp',cond:'hold',pool:'cpt-adv', cr:75, note:'CISSP ‚Üí CompTIA CASP+ CE'},
  {from:'isc-cissp',cond:'hold',pool:'cpt-sec',  cr:50, note:'CISSP ‚Üí Security+ CE'},
  {from:'isc-cissp',cond:'hold',pool:'isa-cpe',  cr:40, note:'ISC¬≤/ISACA reciprocal CPE'},
  {from:'isc-cissp',cond:'earn',pool:'pm-pdu',   cr:15, note:'CISSP exam ‚Üí PMI PDUs'},
  {from:'isa-cism', cond:'hold',pool:'isc-cpe',  cr:30, note:'ISACA/ISC¬≤ reciprocal CPE'},
  {from:'isa-cisa', cond:'hold',pool:'isc-cpe',  cr:30, note:'ISACA/ISC¬≤ reciprocal CPE'},
  {from:'isa-crisc',cond:'hold',pool:'isc-cpe',  cr:30, note:'ISACA/ISC¬≤ reciprocal CPE'},
  {from:'aws-sec',  cond:'earn',pool:'cpt-sec',  cr:30, note:'AWS Sec Spec ‚Üí CompTIA Sec+ CE'},
  {from:'aws-sec',  cond:'earn',pool:'cpt-adv',  cr:30, note:'AWS Sec Spec ‚Üí CASP+ CE'},
  {from:'aws-saa',  cond:'earn',pool:'cpt-net',  cr:20, note:'AWS SAA ‚Üí CompTIA Net+ CE'},
  {from:'aws-saap', cond:'earn',pool:'cpt-adv',  cr:30, note:'AWS SAA Pro ‚Üí CASP+ CE'},
  {from:'sc-200',   cond:'earn',pool:'cpt-sec',  cr:30, note:'SC-200 ‚Üí CompTIA Sec+ CE'},
  {from:'az-500',   cond:'earn',pool:'cpt-sec',  cr:30, note:'AZ-500 ‚Üí CompTIA Sec+ CE'},
  {from:'az-104',   cond:'earn',pool:'cpt-net',  cr:20, note:'AZ-104 ‚Üí CompTIA Net+ CE'},
  {from:'cs-ccna',  cond:'earn',pool:'cpt-net',  cr:30, note:'CCNA ‚Üí CompTIA Net+ CE'},
  {from:'cs-ccnpsec',cond:'earn',pool:'cpt-adv', cr:40, note:'CCNP Sec ‚Üí CASP+ CE'},
  {from:'os-oscp',  cond:'earn',pool:'ec-ece',   cr:40, note:'OSCP ‚Üí EC-Council ECE (CEH renewal)'},
  {from:'gc-gpen',  cond:'earn',pool:'ec-ece',   cr:30, note:'GPEN ‚Üí EC-Council ECE'},
  {from:'cpt-pen',  cond:'earn',pool:'ec-ece',   cr:30, note:'PenTest+ ‚Üí EC-Council ECE'},
  {from:'gc-gsec',  cond:'earn',pool:'isc-cpe',  cr:20, note:'GIAC cert ‚Üí ISC¬≤ CPE'},
  {from:'gc-gcih',  cond:'earn',pool:'isc-cpe',  cr:20, note:'GIAC cert ‚Üí ISC¬≤ CPE'},
  {from:'gc-gpen',  cond:'earn',pool:'isc-cpe',  cr:20, note:'GIAC cert ‚Üí ISC¬≤ CPE'},
  {from:'isa-cism', cond:'earn',pool:'pm-pdu',   cr:15, note:'CISM exam ‚Üí PMI PDUs'},
];

const SUBS = [
  {exam:'cpt-cysa', renews:['cpt-sec']},
  {exam:'cpt-casp', renews:['cpt-sec','cpt-cysa','cpt-pen']},
  {exam:'isc-cissp',renews:['isc-sscp','isc-cc']},
  {exam:'isc-ccsp', renews:['isc-sscp','isc-cc']},
  {exam:'ec-cpent', renews:['ec-ceh']},
  {exam:'cs-ccie',  renews:['cs-ccnpent','cs-ccnpsec','cs-ccna']},
  {exam:'cs-ccnpent',renews:['cs-ccna']},
  {exam:'aws-saap', renews:['aws-saa','aws-cp']},
  {exam:'aws-dop',  renews:['aws-dev','aws-cp']},
  {exam:'gcp-pca',  renews:['gcp-ace']},
  {exam:'os-osep',  renews:['os-oscp']},
  {exam:'it-prac',  renews:['it-found']},
];

const ACTS = [
  {id:'ctf',    n:'CTF Competition',           $:0,   g:{'gc-cpe':8,'cpt-sec':8,'cpt-adv':8,'ec-ece':8,'isc-cpe':4}},
  {id:'blog',   n:'Technical Blog/Writing',    $:0,   g:{'isc-cpe':10,'isa-cpe':10,'cpt-sec':10,'gc-cpe':5}},
  {id:'vol',    n:'Chapter Volunteering',      $:0,   g:{'isc-cpe':20,'isa-cpe':20}},
  {id:'bsides', n:'BSides Conference',         $:25,  g:{'gc-cpe':8,'isc-cpe':8,'isa-cpe':8,'cpt-sec':8,'ec-ece':8}},
  {id:'thm',    n:'TryHackMe Pro (annual)',    $:140, g:{'cpt-core':30,'cpt-sec':50,'ec-ece':40,'gc-cpe':20,'isc-cpe':20}},
  {id:'udemy',  n:'Udemy Bundle',             $:30,  g:{'isc-cpe':15,'cpt-core':15,'cpt-sec':15,'pm-pdu':10}},
  {id:'cybrary',n:'Cybrary (annual)',          $:99,  g:{'isc-cpe':20,'cpt-core':20,'cpt-sec':20,'ec-ece':20,'pm-pdu':15}},
  {id:'plural', n:'Pluralsight (annual)',      $:299, g:{'isc-cpe':60,'cpt-core':30,'cpt-sec':50,'isa-cpe':30,'pm-pdu':20}},
  {id:'cptcm',  n:'CompTIA CertMaster CE',    $:299, g:{'cpt-core':30,'cpt-sec':50,'cpt-net':30,'cpt-adv':75}},
  {id:'ec-asp', n:'EC-Council Aspen (annual)',$:399, g:{'ec-ece':120}},
  {id:'oreilly',n:"O'Reilly Learning (annual)",$:499,g:{'isc-cpe':50,'cpt-core':40,'cpt-sec':40,'isa-cpe':40,'gc-cpe':30,'pm-pdu':30}},
  {id:'htb',    n:'HackTheBox Academy',       $:490, g:{'cpt-sec':60,'cpt-adv':75,'ec-ece':60,'gc-cpe':36,'isc-cpe':30}},
  {id:'defcon', n:'DEF CON',                  $:440, g:{'isc-cpe':24,'isa-cpe':16,'cpt-sec':24,'cpt-adv':24,'ec-ece':24,'gc-cpe':24}},
  {id:'sans',   n:'SANS Training Course',     $:5000,g:{'gc-cpe':40,'isc-cpe':40,'isa-cpe':40,'cpt-sec':60,'cpt-adv':60,'ec-ece':40}},
];

const TRACKS = [
  {id:'red',  color:'#ff4560',icon:'‚öîÔ∏è', n:'Red Team',        desc:'Pen testing, exploit dev, adversary sim',
   phases:[{l:'Foundation',c:['cpt-net','cpt-sec']},{l:'Core',c:['cpt-pen','ec-ceh','os-oscp']},{l:'Expert',c:['gc-gpen','os-osep']}]},
  {id:'blue', color:'#5eb8ff',icon:'üõ°Ô∏è', n:'Blue Team',       desc:'SOC, SIEM, incident response, threat hunting',
   phases:[{l:'Foundation',c:['cpt-sec','isc-cc']},{l:'Core',c:['cpt-cysa','gc-gcih','sc-200']},{l:'Expert',c:['isc-cissp','gc-gcia']}]},
  {id:'cloud',color:'#b388ff',icon:'‚òÅÔ∏è', n:'Cloud Security',  desc:'IAM, CSPM, cloud-native security, multi-cloud',
   phases:[{l:'Foundation',c:['az-900','aws-cp']},{l:'Core',c:['aws-saa','az-104','isc-ccsp']},{l:'Expert',c:['aws-sec','az-500','isc-cissp']}]},
  {id:'grc',  color:'#00e5b0',icon:'üìã', n:'GRC',             desc:'Governance, risk, compliance, audit',
   phases:[{l:'Foundation',c:['cpt-sec','isc-cc']},{l:'Core',c:['isa-cisa','isa-cism']},{l:'Expert',c:['isa-crisc','isc-cissp']}]},
  {id:'devs', color:'#ffb347',icon:'üîß', n:'DevSecOps',       desc:'Secure SDLC, CI/CD, container security',
   phases:[{l:'Foundation',c:['cpt-linux','aws-cp']},{l:'Core',c:['aws-dev','isc-csslp']},{l:'Expert',c:['aws-dop','cpt-casp']}]},
  {id:'net',  color:'#f0c040',icon:'üåê', n:'Network/Infra',   desc:'Network arch, routing, protocols, firewall',
   phases:[{l:'Foundation',c:['cpt-net','cpt-linux']},{l:'Core',c:['cs-ccna','gc-gsec']},{l:'Expert',c:['cs-ccnpent','isc-cissp']}]},
  {id:'dfir', color:'#ff6b6b',icon:'üî¨', n:'DFIR',            desc:'Digital forensics, memory analysis, malware',
   phases:[{l:'Foundation',c:['cpt-sec','gc-gsec']},{l:'Core',c:['ec-chfi','gc-gcfe','gc-gcih']},{l:'Expert',c:['gc-gcia','isc-cissp']}]},
  {id:'dod',  color:'#7986cb',icon:'üéñÔ∏è', n:'DoD/Gov',         desc:'DoD 8570/8140 IAT/IAM compliant path',
   phases:[{l:'IAT-I',c:['cpt-net']},{l:'IAT-II',c:['cpt-sec','ec-ceh']},{l:'IAT-III',c:['cpt-casp','isc-cissp']}]},
];

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// UTILS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
const gd = id => CERTS.find(c => c.id === id);
const fc = n => n === 0 ? 'FREE' : '$' + n.toLocaleString();
const NOW = new Date();
const sColor = {c:'var(--teal)',e:'var(--gold)',x:'var(--red)',u:'var(--d1)',s:'var(--violet)'};
const tierLabel = ['','Entry','Core','Advanced','Expert'];
const tierColor = ['','var(--teal)','var(--sky)','var(--gold)','var(--red)'];

function getStatus(uc) {
  const d = gd(uc.defId); if (!d) return 'u';
  if (uc.studying) return 's'; // in progress
  if (d.nx) return 'c';
  if (!uc.exp) return 'u';
  const days = Math.floor((new Date(uc.exp) - NOW) / 86400000);
  if (days < 0) return 'x';
  if (days < 180) return 'e';
  return 'c';
}
function getDays(uc) {
  if (!uc.exp) return null;
  return Math.floor((new Date(uc.exp) - NOW) / 86400000);
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// ENGINES
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function getCascade(certId, held) {
  const rows = [];
  for (const xg of XG.filter(x => x.from === certId)) {
    const users = held.filter(uc => gd(uc.defId)?.pools?.includes(xg.pool)).map(uc => gd(uc.defId)?.n).filter(Boolean);
    rows.push({type:'xg', pool:xg.pool, cr:xg.cr, cond:xg.cond, note:xg.note, users});
  }
  const sub = SUBS.find(s => s.exam === certId);
  if (sub) sub.renews.forEach(r => {const d=gd(r);if(d)rows.push({type:'sub',name:d.n,note:`Auto-renews ${d.n}`});});
  const def = gd(certId);
  if (def?.sat?.length) def.sat.forEach(sid => {if(held.some(h=>h.defId===sid)){const d=gd(sid);if(d)rows.push({type:'sat',name:d.n,note:`Satisfies ${d.n} prereq`});}});
  return rows;
}

function computeROI(heldList, targetIds) {
  const held = new Set(heldList.map(u => u.defId));
  const tgts = new Set(targetIds);
  const isEmpty = heldList.length === 0;
  return CERTS
    .filter(d => !held.has(d.id) && !tgts.has(d.id))
    .map(d => {
      let score = 0;
      const prereqsMet = (d.pre||[]).every(p => held.has(p));
      const reasons = [];
      for (const xg of XG.filter(x => x.from === d.id)) {
        const u = heldList.filter(uc => gd(uc.defId)?.pools?.includes(xg.pool));
        if (u.length) { score += xg.cr * u.length * 0.4; reasons.push(`+${xg.cr} CE ‚Üí ${u.map(x=>gd(x.defId)?.n).join(', ')}`); }
      }
      const sub = SUBS.find(x => x.exam === d.id);
      if (sub) { const rh = sub.renews.filter(r => held.has(r)); if (rh.length) { score += rh.length * 180; reasons.push(`Auto-renews ${rh.map(r=>gd(r)?.n).join(', ')}`); } }
      const unlocks = CERTS.filter(c => tgts.has(c.id) && (c.pre||[]).includes(d.id) && !held.has(d.id));
      if (unlocks.length) { score += unlocks.length * 160; reasons.push(`Unlocks ${unlocks.map(c=>c.n).join(', ')}`); }
      score += (d.d||5) * 18;
      score += Math.max(0, 10 - d.$/200) * 22;
      if (isEmpty && !(d.pre||[]).length) score += 80;
      if (prereqsMet) score *= 1.3;
      if (d.d >= 9) reasons.push(`Top demand (${d.d}/10)`);
      if (isEmpty && !(d.pre||[]).length) reasons.push('No prerequisites');
      if (d.$ === 0) reasons.push('Free to attempt');
      return { def:d, score:Math.round(score), prereqsMet, reasons };
    })
    .filter(r => isEmpty ? true : r.score > 60)
    .sort((a,b) => b.score - a.score)
    .slice(0, 10);
}

function findPath(goalId, heldSet) {
  if (heldSet.has(goalId)) return [];
  const visited = new Set();
  const queue = [[goalId]];
  while (queue.length) {
    const path = queue.shift();
    const cur = path[path.length-1];
    if (visited.has(cur)) continue;
    visited.add(cur);
    const def = gd(cur); if (!def) continue;
    const unmet = (def.pre||[]).filter(p => !heldSet.has(p));
    if (!unmet.length) return [...path].reverse().filter(id => !heldSet.has(id));
    for (const p of unmet) if (!visited.has(p)) queue.push([...path, p]);
  }
  const out = []; const seen = new Set(heldSet); const proc = [goalId];
  while (proc.length) {
    const id = proc.shift(); if (seen.has(id)) continue; seen.add(id);
    const d = gd(id); if (!d) continue;
    for (const p of (d.pre||[])) if (!seen.has(p)) proc.unshift(p);
    out.push(id);
  }
  return out.filter(id => !heldSet.has(id));
}

function optimize(userCerts, targetIds, customActs=[]) {
  const held = new Set(userCerts.map(u => u.defId));
  const allActs = [...ACTS, ...customActs];
  const bonuses = {};
  for (const uc of userCerts) for (const xg of XG.filter(x => x.from===uc.defId && x.cond==='hold')) bonuses[xg.pool]=(bonuses[xg.pool]||0)+xg.cr;
  const autoCov = new Set();
  for (const sub of SUBS) if (held.has(sub.exam)) sub.renews.forEach(r => autoCov.add(r));
  const needRecert = userCerts.filter(uc => { const d=gd(uc.defId); if(!d||d.nx)return false; const s=getStatus(uc); return s==='x'||s==='e'; });
  const needAcq = targetIds.filter(id => !held.has(id));
  const poolReqs = {};
  const examOnly = [];
  for (const uc of needRecert) {
    if (autoCov.has(uc.defId)) continue;
    const def = gd(uc.defId); if (!def) continue;
    if (def.xo || !def.pools.length) { examOnly.push({uc,def}); continue; }
    const earned = (uc.ceE||0) + (bonuses[def.pools[0]]||0);
    const needed = Math.max(0, def.ce - earned);
    if (needed > 0) for (const pool of def.pools) { if (!poolReqs[pool]) poolReqs[pool]={certs:[],need:0}; poolReqs[pool].certs.push(uc.defId); poolReqs[pool].need=Math.max(poolReqs[pool].need,needed); }
  }
  const rem = JSON.parse(JSON.stringify(poolReqs));
  const chosen = [];
  for (let i=0; i<80 && Object.values(rem).some(r=>r.need>0); i++) {
    let best=null, bS=-1;
    for (const act of allActs) {
      if (chosen.find(c=>c.id===act.id)) continue;
      let cov=0; for (const [p,cr] of Object.entries(act.g||{})) if (rem[p]?.need>0) cov+=Math.min(cr,rem[p].need);
      if (!cov) continue; const s=cov/Math.max(act.$,1); if(s>bS){bS=s;best=act;}
    }
    if (!best) break;
    chosen.push(best);
    for (const [p,cr] of Object.entries(best.g||{})) if (rem[p]) rem[p].need=Math.max(0,rem[p].need-cr);
  }
  const steps = [];
  for (const certId of autoCov) { if (!needRecert.find(u=>u.defId===certId)) continue; const def=gd(certId); steps.push({type:'auto',title:def?.n+' ‚Äî auto-renewed',cost:0,covers:[certId]}); }
  for (const act of chosen) { const cov=[...new Set(Object.keys(act.g||{}).filter(p=>poolReqs[p]).flatMap(p=>poolReqs[p]?.certs||[]))]; steps.push({type:act.$===0?'free':'ce',title:act.n,cost:act.$,covers:cov}); }
  for (const {uc,def} of examOnly) steps.push({type:'exam',title:def.n+' retake',cost:def.$,covers:[uc.defId]});
  const tempHeld = new Set(held);
  for (const tid of needAcq) {
    const path = findPath(tid, tempHeld);
    for (const id of path) {
      if (tempHeld.has(id)) continue;
      const def=gd(id); if(!def) continue;
      const cas=getCascade(id,userCerts);
      steps.push({type:'newcert',title:`Earn ${def.n}`,cost:def.$,covers:[],cascade:cas,isTarget:id===tid});
      tempHeld.add(id);
    }
  }
  steps.sort((a,b) => ({auto:0,free:1,ce:2,exam:3,newcert:4}[a.type]-{auto:0,free:1,ce:2,exam:3,newcert:4}[b.type])||a.cost-b.cost);
  return {steps, total:steps.reduce((s,st)=>s+st.cost,0), needRecert:needRecert.length, newCerts:needAcq.length};
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SMALL COMPONENTS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function ArcRing({days, cy, size=34, sw=3}) {
  const r = (size-sw*2)/2;
  const circ = 2*Math.PI*r;
  const total = cy*365;
  const pct = days===null ? 0 : Math.max(0,Math.min(1,days/total));
  const color = days===null?'var(--d1)':days<0?'var(--red)':days<180?'var(--gold)':'var(--teal)';
  return (
    <div className="arc">
      <svg width={size} height={size} style={{transform:'rotate(-90deg)'}}>
        <circle cx={size/2} cy={size/2} r={r} fill="none" stroke="var(--w1)" strokeWidth={sw}/>
        <circle cx={size/2} cy={size/2} r={r} fill="none" stroke={color} strokeWidth={sw}
          strokeDasharray={`${pct*circ} ${circ}`} strokeLinecap="round"/>
      </svg>
    </div>
  );
}

function CascadePanel({certId, userCerts}) {
  const rows = useMemo(() => getCascade(certId, userCerts), [certId, userCerts]);
  if (!rows.length) return <div className="tiny mono cd" style={{marginTop:6}}>No cross-grant effects for current portfolio.</div>;
  return (
    <div className="casc">
      <div className="casc-lbl">CASCADE ON EARN</div>
      {rows.map((r,i) => (
        <div key={i} className="casc-row">
          <span style={{color:r.type==='xg'?'var(--d3)':r.type==='sub'?'var(--violet)':'var(--teal)'}}>
            {r.type==='xg'?'‚Üó':r.type==='sub'?'‚üπ':'‚úì'} {r.note}
          </span>
          {r.type==='xg'&&<span className="ct bold">+{r.cr} CE</span>}
        </div>
      ))}
    </div>
  );
}

// Pool inspector ‚Äî "what feeds this pool?"
function PoolInspector({poolId, userCerts}) {
  const sources = [];
  // From activities
  for (const act of ACTS) { if (act.g[poolId]) sources.push({type:'act',name:act.n,cr:act.g[poolId],cost:act.$}); }
  // From XG certs
  for (const xg of XG.filter(x=>x.pool===poolId)) {
    const d = gd(xg.from); if (!d) continue;
    const held = userCerts.some(u=>u.defId===xg.from);
    sources.push({type:'cert',name:d.n,cr:xg.cr,cond:xg.cond,held,cost:d.$});
  }
  sources.sort((a,b) => (a.type==='cert'?0:1)-(b.type==='cert'?0:1)||(b.cr-a.cr));
  return (
    <div className="pool-panel">
      <div className="slbl mb8">SOURCES FOR POOL: {poolId}</div>
      {sources.map((s,i) => (
        <div key={i} className="pool-row">
          <div>
            <span className="pool-source">{s.type==='cert'?`[${s.held?'‚úìHELD':'cert'}] `:''}{s.name}</span>
            {s.type==='cert'&&s.cond&&<span className="tiny cd mono"> on {s.cond}</span>}
          </div>
          <span className="pool-cr">+{s.cr} CE</span>
        </div>
      ))}
      {!sources.length&&<div className="tiny cd mono">No sources found for this pool.</div>}
    </div>
  );
}

// Network Graph (SVG force-sim approximation ‚Äî static layout by pool)
function NetworkGraph({userCerts, targetIds}) {
  const heldIds = new Set(userCerts.map(u=>u.defId));
  const tgtIds = new Set(targetIds);
  const svgRef = useRef(null);
  const W = 600, H = 340;

  // Collect unique nodes and edges
  const certNodes = []; const poolNodes = []; const edges = [];
  const knownPools = new Set();

  for (const xg of XG) {
    const fromDef = gd(xg.from); if (!fromDef) continue;
    if (!certNodes.find(n=>n.id===xg.from)) certNodes.push({id:xg.from,name:fromDef.n,held:heldIds.has(xg.from),tgt:tgtIds.has(xg.from)});
    knownPools.add(xg.pool);
    edges.push({from:xg.from,to:'pool:'+xg.pool,cr:xg.cr});
  }
  for (const pool of knownPools) poolNodes.push({id:'pool:'+pool,name:pool});

  // Also add held certs with pools
  for (const uc of userCerts) {
    const d=gd(uc.defId); if(!d||!d.pools.length) continue;
    if (!certNodes.find(n=>n.id===uc.defId)) certNodes.push({id:uc.defId,name:d.n,held:true,tgt:false});
    for (const p of d.pools) { knownPools.add(p); if(!poolNodes.find(n=>n.id==='pool:'+p))poolNodes.push({id:'pool:'+p,name:p}); }
  }

  // Simple circular layout
  const allNodes = [...certNodes, ...poolNodes];
  const cx=W/2, cy=H/2;
  const certR=120, poolR=60;
  const placed = {};
  certNodes.forEach((n,i) => {
    const a = (i/certNodes.length)*2*Math.PI - Math.PI/2;
    placed[n.id]={x:cx+certR*Math.cos(a),y:cy+certR*Math.sin(a)};
  });
  poolNodes.forEach((n,i) => {
    const a = (i/poolNodes.length)*2*Math.PI - Math.PI/2;
    placed[n.id]={x:cx+poolR*Math.cos(a)*0.7+cx*0.05,y:cy+poolR*Math.sin(a)*0.7};
  });

  const isEmpty = certNodes.length===0;

  return (
    <div className="graph-wrap">
      {isEmpty ? (
        <div className="empty" style={{padding:'30px'}}><div className="empty-icon">üï∏Ô∏è</div><div className="empty-msg">Add certs to see the cross-grant network graph.</div></div>
      ) : (
        <svg ref={svgRef} width="100%" viewBox={`0 0 ${W} ${H}`} style={{display:'block'}}>
          {edges.map((e,i) => {
            const f=placed[e.from], t=placed[e.to];
            if(!f||!t)return null;
            const active = heldIds.has(e.from)||tgtIds.has(e.from);
            return <line key={i} x1={f.x} y1={f.y} x2={t.x} y2={t.y} stroke={active?'var(--teal)':'var(--w2)'} strokeWidth={active?1.5:.5} strokeOpacity={active?.5:.2}/>;
          })}
          {poolNodes.map((n,i) => {
            const pos=placed[n.id]; if(!pos)return null;
            return (
              <g key={n.id}>
                <circle cx={pos.x} cy={pos.y} r={16} fill="var(--s3)" stroke="var(--w3)" strokeWidth={1}/>
                <text x={pos.x} y={pos.y+3} textAnchor="middle" fill="var(--d2)" fontSize="6" fontFamily="var(--mono)">{n.name.split('-').pop()}</text>
              </g>
            );
          })}
          {certNodes.map((n,i) => {
            const pos=placed[n.id]; if(!pos)return null;
            const color = n.held?'var(--teal)':n.tgt?'var(--violet)':'var(--w3)';
            return (
              <g key={n.id}>
                <circle cx={pos.x} cy={pos.y} r={n.held?10:7} fill={n.held?'var(--teal)':n.tgt?'var(--viold)':'var(--s3)'} stroke={color} strokeWidth={1.5}/>
                <text x={pos.x} y={pos.y+18} textAnchor="middle" fill={color} fontSize="7" fontFamily="var(--mono)" style={{pointerEvents:'none'}}>
                  {n.name.length>10?n.name.slice(0,10)+'‚Ä¶':n.name}
                </text>
              </g>
            );
          })}
        </svg>
      )}
      <div className="graph-legend">
        {[['var(--teal)','Held cert'],['var(--violet)','Target cert'],['var(--w3)','Source cert'],['var(--w3)','CE pool (inner)']].map(([c,l])=>(
          <div key={l} className="gl-item"><div className="gl-dot" style={{background:c}}/>{l}</div>
        ))}
      </div>
    </div>
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// CERT MODAL
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function CertModal({existing, onClose, onSave, onDelete}) {
  useEffect(()=>{
    const handler = e => { if(e.key==='Escape') onClose(); };
    document.addEventListener('keydown', handler);
    return () => document.removeEventListener('keydown', handler);
  }, [onClose]);
  const [defId,setDefId]=useState(existing?.defId||'');
  const [exp,setExp]=useState(existing?.exp||'');
  const [ceE,setCeE]=useState(existing?.ceE||0);
  const clampCeE = v => { const n=parseInt(v)||0; const max=gd(defId)?.ce||999; setCeE(Math.max(0,Math.min(max,n))); };
  const [notes,setNotes]=useState(existing?.notes||'');
  const [studying,setStudying]=useState(existing?.studying||false);
  const def=gd(defId);
  const bodies=[...new Set(CERTS.map(d=>d.v))].sort();
  const isEdit=!!existing;

  const save=()=>{
    if(!defId)return;
    onSave({defId,exp,ceE:parseInt(ceE)||0,notes,studying,id:existing?.id||Date.now().toString()});
    onClose();
  };

  return (
    <div className="ov" onClick={onClose}>
      <div className="modal" onClick={e=>e.stopPropagation()}>
        <div className="modal-handle"/>
        <div className="modal-title">{isEdit?'Edit':'Add'} Certification</div>
        {!isEdit&&(
          <div className="fg">
            <label className="fl">Certification</label>
            <select className="fsel" value={defId} onChange={e=>setDefId(e.target.value)}>
              <option value="">‚Äî Select ‚Äî</option>
              {bodies.map(b=>(
                <optgroup label={b} key={b}>
                  {CERTS.filter(d=>d.v===b).map(d=><option key={d.id} value={d.id}>{d.n}</option>)}
                </optgroup>
              ))}
            </select>
          </div>
        )}
        {def&&(
          <div className="ban ban-c mb8">
            <span className="ct mono bold">{def.v} {def.n}</span> ‚Äî {def.nx?'No expiry':`${def.cy}yr cycle`}
            {def.xo?' ¬∑ Exam-only':def.ce>0?` ¬∑ ${def.ce} CE required`:''}
            {def.$>0?` ¬∑ ${fc(def.$)}`:''}
          </div>
        )}
        {def&&!def.nx&&(
          <div className="fg"><label className="fl">Expiry Date</label><input type="date" className="fi" value={exp} onChange={e=>setExp(e.target.value)}/></div>
        )}
        {def&&!def.xo&&def.ce>0&&(
          <div className="fg"><label className="fl">CE Credits Earned (of {def.ce})</label><input type="number" className="fi" value={ceE} min="0" max={def.ce} onChange={e=>clampCeE(e.target.value)}/></div>
        )}
        <div className="fg"><label className="fl">Notes</label><input className="fi" value={notes} onChange={e=>setNotes(e.target.value)} placeholder="optional‚Ä¶"/></div>
        <div className="fg" style={{display:'flex',alignItems:'center',gap:10}}>
          <label style={{display:'flex',alignItems:'center',gap:8,cursor:'pointer',userSelect:'none'}}>
            <div style={{
              width:36,height:20,borderRadius:10,background:studying?'var(--violet)':'var(--w2)',
              position:'relative',transition:'background .2s',cursor:'pointer',flexShrink:0
            }} onClick={()=>setStudying(p=>!p)}>
              <div style={{
                position:'absolute',top:3,left:studying?17:3,width:14,height:14,
                borderRadius:50,background:'white',transition:'left .2s'
              }}/>
            </div>
            <span className="mono tiny" style={{color:studying?'var(--violet)':'var(--d2)'}}>
              {studying ? 'üìñ Currently Studying' : 'Mark as In-Progress'}
            </span>
          </label>
        </div>
        <div className="modal-foot">
          {isEdit&&<button className="btn btn-red btn-sm" onClick={()=>{onDelete(existing.id);onClose();}}>Delete</button>}
          <div style={{flex:1}}/>
          <button className="btn btn-ghost" onClick={onClose}>Cancel</button>
          <button className="btn btn-teal" onClick={save} disabled={!defId}>Save</button>
        </div>
      </div>
    </div>
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// VIEWS
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê

// ‚îÄ‚îÄ PORTFOLIO
function PortfolioView({userCerts,setUserCerts}) {
  const [showAdd,setShowAdd]=useState(false);
  const [editing,setEditing]=useState(null);
  const [filter,setFilter]=useState('all');
  const save=c=>setUserCerts(p=>p.some(u=>u.id===c.id)?p.map(u=>u.id===c.id?c:u):[...p,c]);
  const del=id=>setUserCerts(p=>p.filter(u=>u.id!==id));
  const list=userCerts.filter(uc=>filter==='all'||getStatus(uc)===filter.slice(0,1));

  return (
    <div className="content-pad">
      <div className="sh">
        <div className="flex fac g6 fw">
          <span className="slbl">Portfolio ({userCerts.length})</span>
          <div className="flex g4 fw">
            {[['all','ALL'],['c','CURRENT'],['e','EXPIRING'],['x','EXPIRED']].map(([f,l])=>(
              <button key={f} className={`btn btn-sm ${filter===f?'btn-teal':'btn-ghost'}`} onClick={()=>setFilter(f)}>{l}</button>
            ))}
          </div>
        </div>
        <button className="btn btn-teal btn-sm" onClick={()=>setShowAdd(true)}>+ Add</button>
      </div>
      {list.length===0?(
        <div className="empty"><div className="empty-icon">üèÖ</div><div className="empty-msg">{userCerts.length===0?'No certs yet.\nTap + Add to start.':'No certs match filter.'}</div></div>
      ):(
        <div className="cgrid">
          {list.map(uc=>{
            const def=gd(uc.defId);if(!def)return null;
            const s=getStatus(uc);const days=getDays(uc);
            const xg=XG.filter(x=>x.from===uc.defId);
            return (
              <div key={uc.id} className={`cc s-${s}`} onClick={()=>setEditing(uc)}>
                <div className="cc-head">
                  <div>
                    <div className="cc-name">{def.n}</div>
                    <div className="cc-vendor">{def.v}</div>
                    <div className="cc-tier" style={{color:tierColor[Math.min(def.t,4)]}}>{tierLabel[Math.min(def.t,4)]?.toUpperCase()}</div>
                  </div>
                  <div style={{textAlign:'center'}}>
                    {def.nx?(
                      <div style={{width:34,height:34,display:'flex',alignItems:'center',justifyContent:'center',fontSize:18,color:'var(--teal)'}}>‚àû</div>
                    ):(
                      <ArcRing days={days} cy={def.cy}/>
                    )}
                    <div className="arc-lbl" style={{color:def.nx?'var(--teal)':sColor[s]}}>
                      {def.nx?'PERM':days===null?'?':days>365?Math.floor(days/365)+'y':days>0?days+'d':'EXP'}
                    </div>
                  </div>
                </div>
                <div className="cc-meta">
                  {!def.nx&&uc.exp&&<div className="cc-row"><span className="cc-key">EXPIRES</span><span className="cc-val" style={{color:sColor[s]}}>{uc.exp}</span></div>}
                  {uc.studying&&<div className="cc-row"><span className="cc-key">STATUS</span><span className="cc-val" style={{color:'var(--violet)'}}>üìñ In Progress</span></div>}
                {def.ce>0&&!def.xo&&<div className="cc-row"><span className="cc-key">CE</span><span className="cc-val cp">{uc.ceE||0}/{def.ce}</span></div>}
                  {def.xo&&<div className="cc-key">Exam-only recert</div>}
                </div>
                {def.ce>0&&!def.xo&&<div className="cc-bar"><div className="cc-fill" style={{width:`${Math.min(100,((uc.ceE||0)/def.ce)*100)}%`,background:sColor[s]}}/></div>}
                {xg.length>0&&<div className="cc-xg">‚Üó Cross-grants {xg.length} pool{xg.length>1?'s':''}</div>}
              </div>
            );
          })}
        </div>
      )}
      {showAdd&&<CertModal onClose={()=>setShowAdd(false)} onSave={save} onDelete={del}/>}
      {editing&&<CertModal existing={editing} onClose={()=>setEditing(null)} onSave={save} onDelete={del}/>}
    </div>
  );
}

// ‚îÄ‚îÄ RECOMMENDATIONS
function RecsView({userCerts,targetIds,setTargetIds}) {
  const [activeTrack,setActiveTrack]=useState(null);
  const [goalId,setGoalId]=useState('');
  const [pathResult,setPathResult]=useState(null);
  const [expandedRec,setExpandedRec]=useState(null);
  const [quizStep,setQuizStep]=useState(null); // null | 'track' | 'goal'
  const held=useMemo(()=>new Set(userCerts.map(u=>u.defId)),[userCerts]);
  const isEmpty=userCerts.length===0;
  const recs=useMemo(()=>computeROI(userCerts,targetIds),[userCerts,targetIds]);
  const addTgt=id=>{if(!targetIds.includes(id))setTargetIds(p=>[...p,id]);};
  const rmTgt=id=>setTargetIds(p=>p.filter(x=>x!==id));
  const bodies=[...new Set(CERTS.map(d=>d.v))].sort();

  // Auto-suggested starter paths (no prereqs, high demand, grouped by domain)
  const STARTER_PATHS = [
    { label:'Security Generalist', color:'#00e5b0', icon:'üõ°Ô∏è',
      ids:['cpt-sec','aws-cp','isc-cc','az-900'],
      why:'Core hiring baseline. Security+ alone opens 80%+ of entry-level roles. ISC¬≤ CC is free.' },
    { label:'Cloud Security', color:'#b388ff', icon:'‚òÅÔ∏è',
      ids:['aws-cp','az-900','aws-saa','sc-200'],
      why:'Fastest-growing domain. Cloud certs cross-grant CE into each other.' },
    { label:'Red Team Entry', color:'#ff4560', icon:'‚öîÔ∏è',
      ids:['cpt-net','cpt-sec','cpt-pen'],
      why:'CompTIA stack is sequential. PenTest+ cross-grants EC-Council ECE credits.' },
    { label:'GRC / Compliance', color:'#f0c040', icon:'üìã',
      ids:['cpt-sec','isc-cc','isa-cisa'],
      why:'High pay ceiling, low lab requirement. CISA is the gold standard for auditors.' },
    { label:'DoD / Government', color:'#7986cb', icon:'üéñÔ∏è',
      ids:['cpt-net','cpt-sec','cpt-casp'],
      why:'8570 IAT-II (Sec+) required for most DoD positions. CASP+ satisfies IAT-III.' },
  ];

  const applyTrack=track=>{
    setActiveTrack(track.id);
    const ids=track.phases.flatMap(p=>p.c).filter(id=>!held.has(id));
    setTargetIds(prev=>[...new Set([...prev,...ids])]);
  };

  const applyStarterPath=sp=>{
    const ids=sp.ids.filter(id=>!held.has(id));
    setTargetIds(prev=>[...new Set([...prev,...ids])]);
    // Auto-compute path to last cert
    const goal=sp.ids[sp.ids.length-1];
    setGoalId(goal);
    setPathResult({goalId:goal, path:findPath(goal,held)});
  };

  const computePath=()=>{
    if(!goalId)return;
    setPathResult({goalId,path:findPath(goalId,held)});
  };

  // Auto-suggest a path on mount if portfolio is empty
  useEffect(()=>{
    if(isEmpty && !pathResult){
      const goal='cpt-sec';
      setPathResult({goalId:goal, path:findPath(goal,new Set())});
    }
  },[isEmpty]);

  return (
    <div className="content-pad">

      {/* ‚îÄ‚îÄ EMPTY STATE ONBOARDING ‚îÄ‚îÄ */}
      {isEmpty && (
        <div className="card mb16" style={{borderColor:'var(--tealb)',background:'linear-gradient(135deg,#00e5b008,#b388ff05)'}}>
          <div style={{display:'flex',alignItems:'center',gap:10,marginBottom:12}}>
            <span style={{fontSize:24}}>üëã</span>
            <div>
              <div style={{fontWeight:700,fontSize:14,color:'var(--d5)'}}>Welcome to CertPath</div>
              <div className="tiny mono cd">No certs in portfolio yet. Here's where to start.</div>
            </div>
          </div>
          <div style={{display:'grid',gridTemplateColumns:'repeat(auto-fill,minmax(200px,1fr))',gap:8}}>
            {STARTER_PATHS.map(sp=>{
              const cost=sp.ids.reduce((s,id)=>s+(gd(id)?.$||0),0);
              return (
                <div key={sp.label} className="card2" style={{borderColor:sp.color+'33',cursor:'pointer',transition:'all .15s'}}
                  onClick={()=>applyStarterPath(sp)}>
                  <div style={{display:'flex',alignItems:'center',gap:6,marginBottom:6}}>
                    <span style={{fontSize:16}}>{sp.icon}</span>
                    <span style={{fontWeight:700,fontSize:11,color:sp.color}}>{sp.label}</span>
                  </div>
                  <div style={{fontSize:10,color:'var(--d2)',lineHeight:1.5,marginBottom:8}}>{sp.why}</div>
                  <div style={{display:'flex',flexWrap:'wrap',gap:3,marginBottom:7}}>
                    {sp.ids.map(id=><span key={id} className="tag tgrey">{gd(id)?.n}</span>)}
                  </div>
                  <div style={{display:'flex',justifyContent:'space-between',alignItems:'center'}}>
                    <span className="mono tiny cd">{fc(cost)} total</span>
                    <span className="btn btn-xs" style={{background:sp.color,color:'var(--bg)',border:'none',fontWeight:700}}>Start ‚Üí</span>
                  </div>
                </div>
              );
            })}
          </div>
          <div className="tiny mono cd mt8" style={{textAlign:'center'}}>Tap a path to load targets and see your step-by-step plan ‚Üì</div>
        </div>
      )}

      {/* ‚îÄ‚îÄ SUGGESTED / COMPUTED PATH ‚îÄ‚îÄ */}
      {pathResult && (
        <div className="mb16">
          <div className="sh">
            <span className="slbl">{isEmpty ? '‚≠ê SUGGESTED STARTING PATH' : 'PATH TO GOAL'}</span>
            <button className="btn btn-xs btn-ghost" onClick={()=>setPathResult(null)}>‚úï Clear</button>
          </div>
          <div className="card" style={{borderColor: isEmpty ? 'var(--tealb)' : 'var(--violb)'}}>
            <div style={{display:'flex',justifyContent:'space-between',alignItems:'baseline',marginBottom:10,flexWrap:'wrap',gap:6}}>
              <div>
                <span style={{fontWeight:700,fontSize:13,color:isEmpty?'var(--teal)':'var(--violet)'}}>{gd(pathResult.goalId)?.n}</span>
                <span className="tiny mono cd" style={{marginLeft:8}}>via {gd(pathResult.goalId)?.v}</span>
              </div>
              <div className="flex fac g8">
                <span className="mono xs cy">{pathResult.path.length} step{pathResult.path.length!==1?'s':''}</span>
                <span className="mono xs ct">{fc(pathResult.path.reduce((s,id)=>s+(gd(id)?.$||0),0))}</span>
              </div>
            </div>
            {pathResult.path.length===0 ? (
              <div className="ban ban-ok">All prerequisites already met ‚Äî ready to sit the exam.</div>
            ) : (
              <>
                <div className="path-wrap">
                  {pathResult.path.map((id,i)=>{
                    const def=gd(id);if(!def)return null;
                    const isFinal=i===pathResult.path.length-1;
                    const cas=getCascade(id,userCerts);
                    return (
                      <div key={id} className={`path-node ${isFinal?'goal':''}`}>
                        <div className={`path-dot ${isFinal?'pgoal':''}`}/>
                        <div className="path-info">
                          <div className="path-name" style={{color:isFinal?'var(--violet)':'var(--d5)'}}>
                            <span className="mono tiny cd" style={{marginRight:6}}>Step {i+1}</span>
                            {def.n}
                          </div>
                          <div className="path-sub">{def.v} ¬∑ {fc(def.$)} ¬∑ {def.nx?'No expiry':def.cy+'yr cycle'}</div>
                          {cas.length>0&&<div className="path-casc">{cas.slice(0,2).map(c=>c.note).join(' ¬∑ ')}{cas.length>2?` +${cas.length-2} more`:''}</div>}
                        </div>
                        {!targetIds.includes(id)&&(
                          <button className="btn btn-viol btn-xs" onClick={e=>{e.stopPropagation();addTgt(id);}}>+ Target</button>
                        )}
                      </div>
                    );
                  })}
                </div>
                <div className="flex g6 mt8 fw">
                  <button className="btn btn-viol btn-sm" onClick={()=>pathResult.path.forEach(id=>{if(!targetIds.includes(id))addTgt(id);})}>Add All to Targets</button>
                  <button className="btn btn-ghost btn-sm" onClick={()=>{const goal=pathResult.goalId;setGoalId(goal);}}>Change Goal</button>
                </div>
              </>
            )}
          </div>
        </div>
      )}

      {/* ‚îÄ‚îÄ CUSTOM PATH PLANNER ‚îÄ‚îÄ */}
      <div className="sh"><span className="slbl">Custom Path Planner</span></div>
      <div style={{display:'flex',gap:7,marginBottom:16,flexWrap:'wrap'}}>
        <select className="fsel" style={{flex:1,minWidth:120}} value={goalId} onChange={e=>setGoalId(e.target.value)}>
          <option value="">‚Äî Pick any goal cert ‚Äî</option>
          {bodies.map(b=>(
            <optgroup label={b} key={b}>
              {CERTS.filter(d=>d.v===b&&!held.has(d.id)).map(d=><option key={d.id} value={d.id}>{d.n} ({fc(d.$)})</option>)}
            </optgroup>
          ))}
        </select>
        <button className="btn btn-teal" onClick={computePath} disabled={!goalId}>Compute ‚Üí</button>
      </div>

      <hr className="divider"/>

      {/* ‚îÄ‚îÄ CAREER TRACKS ‚îÄ‚îÄ */}
      <div className="sh"><span className="slbl">Career Track Templates</span></div>
      <div className="tgrid mb16">
        {TRACKS.map(t=>{
          const toDo=t.phases.flatMap(p=>p.c).filter(id=>!held.has(id)).length;
          const done=t.phases.flatMap(p=>p.c).filter(id=>held.has(id)).length;
          const total=t.phases.flatMap(p=>p.c).length;
          const pct=total>0?Math.round((done/total)*100):0;
          return (
            <div key={t.id} className={`tcard ${activeTrack===t.id?'sel':''}`} onClick={()=>applyTrack(t)}>
              <div className="tcard-bar" style={{background:t.color}}/>
              <div className="tcard-icon">{t.icon}</div>
              <div className="tcard-name" style={{color:t.color}}>{t.n}</div>
              <div className="tcard-desc">{t.desc}</div>
              <div style={{display:'flex',justifyContent:'space-between',alignItems:'center',marginTop:6}}>
                <div className="tcard-count">{toDo} remaining</div>
                {pct>0&&<span className="mono tiny ct">{pct}% done</span>}
              </div>
              {pct>0&&<div className="cc-bar mt8"><div className="cc-fill" style={{width:pct+'%',background:t.color}}/></div>}
            </div>
          );
        })}
      </div>

      <hr className="divider"/>

      {/* ‚îÄ‚îÄ ROI RECOMMENDATIONS ‚îÄ‚îÄ */}
      <div className="sh">
        <span className="slbl">{isEmpty?'Top Certs to Start With':'ROI Recommendations'}</span>
        <span className="tiny mono cd">{isEmpty?'ranked by demand + no-prereq bonus':'ranked by cascade value, demand, speed'}</span>
      </div>
      {recs.length===0 ? (
        <div className="ban ban-ok">You've targeted or hold all top-ranked certs. Go to Roadmap to explore remaining certifications.</div>
      ) : (
        recs.map((rec,i)=>{
          const isTgt=targetIds.includes(rec.def.id);
          const showCasc=expandedRec===rec.def.id;
          const accentColor=i<3?'var(--teal)':i<6?'var(--sky)':'var(--d1)';
          return (
            <div key={rec.def.id} className="rec" style={{'--rank-color':accentColor}}>
              <div className="rec-rank" style={{color:accentColor}}>{i+1}</div>
              <div className="rec-body">
                <div className="rec-name">{rec.def.n}</div>
                <div className="rec-sub">
                  {rec.def.v}
                  <span style={{marginLeft:6,color:rec.prereqsMet?'var(--teal)':'var(--gold)'}}>
                    ¬∑ {rec.prereqsMet ? 'Ready now' : `Needs: ${(rec.def.pre||[]).map(p=>gd(p)?.n).join(', ')}`}
                  </span>
                </div>
                {rec.reasons.length>0&&(
                  <div className="rec-tags">
                    {rec.reasons.slice(0,3).map((r,j)=>(
                      <span key={j} className={`tag ${j===0?'tteal':j===1?'tsky':'tviolet'}`}>{r}</span>
                    ))}
                  </div>
                )}
                <div className="rec-stats">
                  <span className="rec-stat">DEMAND <span>{rec.def.d}/10</span></span>
                  <span className="rec-stat">COST <span>{fc(rec.def.$)}</span></span>
                  <span className="rec-stat">CYCLE <span>{rec.def.nx?'‚àû':rec.def.cy+'yr'}</span></span>
                </div>
                {showCasc&&<CascadePanel certId={rec.def.id} userCerts={userCerts}/>}
              </div>
              <div className="rec-acts">
                <button className="btn btn-xs btn-ghost" onClick={()=>setExpandedRec(showCasc?null:rec.def.id)}>{showCasc?'Hide':'Cascade'}</button>
                <button className="btn btn-xs btn-ghost" onClick={()=>{
                  setGoalId(rec.def.id);
                  setPathResult({goalId:rec.def.id,path:findPath(rec.def.id,held)});
                  window.scrollTo({top:0,behavior:'smooth'});
                }}>Path ‚Üí</button>
                {!isTgt ? (
                  <button className="btn btn-xs btn-viol" onClick={()=>addTgt(rec.def.id)}>+ Target</button>
                ) : (
                  <button className="btn btn-xs btn-ghost" onClick={()=>rmTgt(rec.def.id)}>‚úì Listed</button>
                )}
              </div>
            </div>
          );
        })
      )}
    </div>
  );
}

// ‚îÄ‚îÄ ROADMAP
function RoadmapView({userCerts,targetIds,setTargetIds}) {
  const [search,setSearch]=useState('');
  const [vendor,setVendor]=useState('All');
  const [expandedCasc,setExpandedCasc]=useState(null);
  const held=useMemo(()=>new Set(userCerts.map(u=>u.defId)),[userCerts]);
  const toggle=id=>setTargetIds(p=>p.includes(id)?p.filter(x=>x!==id):[...p,id]);
  const vendors=['All',...new Set(CERTS.map(d=>d.v)).values()].sort();

  const list=CERTS.filter(d=>{
    if(held.has(d.id))return false;
    if(vendor!=='All'&&d.v!==vendor)return false;
    if(search&&!d.n.toLowerCase().includes(search.toLowerCase())&&!d.v.toLowerCase().includes(search.toLowerCase()))return false;
    return true;
  });

  return (
    <div className="content-pad">
      <div className="sh">
        <span className="slbl">Roadmap ‚Äî {targetIds.length} targeted</span>
        {targetIds.length>0&&<button className="btn btn-red btn-xs" onClick={()=>setTargetIds([])}>Clear All</button>}
      </div>
      {targetIds.length>0&&(
        <div className="mb12">
          <div className="slbl mb6">SELECTED TARGETS</div>
          <div className="flex fw g4">{targetIds.map(id=><span key={id} className="tag tviolet" style={{cursor:'pointer'}} onClick={()=>toggle(id)}>{gd(id)?.n} ‚úï</span>)}</div>
        </div>
      )}
      <div className="ban ban-v mb10">Select certs to acquire. Cascade Preview shows CE flow effects before committing.</div>
      <div className="flex g8 mb12 fw">
        <input className="fi" style={{flex:1,minWidth:120,margin:0}} placeholder="Search‚Ä¶" value={search} onChange={e=>setSearch(e.target.value)}/>
        <select className="fsel" style={{width:'auto'}} value={vendor} onChange={e=>setVendor(e.target.value)}>
          {vendors.map(v=><option key={v}>{v}</option>)}
        </select>
      </div>
      <div className="cgrid">
        {list.map(def=>{
          const isTgt=targetIds.includes(def.id);
          const prereqsMet=(def.pre||[]).every(p=>held.has(p));
          const showCasc=expandedCasc===def.id;
          return (
            <div key={def.id} className={`cc ${isTgt?'s-t':'s-u'}`} style={{cursor:'default',background:isTgt?'var(--viold)':undefined,borderColor:isTgt?'var(--violb)':undefined}}>
              <div className="cc-head">
                <div>
                  <div className="cc-name">{def.n}</div>
                  <div className="cc-vendor">{def.v}</div>
                  <div className="cc-tier" style={{color:tierColor[Math.min(def.t,4)]}}>{tierLabel[Math.min(def.t,4)]?.toUpperCase()}</div>
                </div>
                <div style={{textAlign:'right'}}>
                  <div className="mono tiny ct bold mb8">{fc(def.$)}</div>
                  <div className="mono tiny cd">{def.nx?'‚àû':def.cy+'yr'}</div>
                  {isTgt&&<div className="mt8"><span className="pill pv">TARGETED</span></div>}
                </div>
              </div>
              {!prereqsMet&&<div className="tiny cy mono mb8">‚ö† Needs: {(def.pre||[]).filter(p=>!held.has(p)).map(p=>gd(p)?.n).join(', ')}</div>}
              <div className="flex g4 mt8">
                <button className={`btn btn-xs ${isTgt?'btn-ghost':'btn-viol'}`} onClick={()=>toggle(def.id)}>{isTgt?'‚úì Remove':'+ Target'}</button>
                <button className="btn btn-xs btn-ghost" onClick={()=>setExpandedCasc(showCasc?null:def.id)}>{showCasc?'Hide':'Cascade'}</button>
              </div>
              {showCasc&&<CascadePanel certId={def.id} userCerts={userCerts}/>}
            </div>
          );
        })}
      </div>
      {list.length===0&&<div className="empty"><div className="empty-icon">üîç</div><div className="empty-msg">No results.</div></div>}
    </div>
  );
}

// ‚îÄ‚îÄ CROSS-GRANTS + NETWORK
function CrossView({userCerts,targetIds}) {
  const held=new Set(userCerts.map(u=>u.defId));
  const tgts=new Set(targetIds);
  const active=XG.filter(x=>held.has(x.from));
  const fromTgts=XG.filter(x=>tgts.has(x.from)&&!held.has(x.from));
  const [selectedPool,setSelectedPool]=useState(null);

  const allPools=[...new Set(CERTS.flatMap(d=>d.pools))].sort();

  return (
    <div className="content-pad">
      <div className="slbl mb8">CROSS-VENDOR CE NETWORK</div>
      <NetworkGraph userCerts={userCerts} targetIds={targetIds}/>
      <div className="ban ban-c mt12 mb12">Nodes = certs. Inner circles = CE pools. Lines = grant flows. Teal = held, purple = targeted.</div>

      {/* Pool Inspector */}
      <div className="sh mt12"><span className="slbl">POOL INSPECTOR ‚Äî what feeds a CE pool?</span></div>
      <div className="flex fw g4 mb8">
        {allPools.map(p=>(
          <button key={p} className={`btn btn-xs ${selectedPool===p?'btn-teal':'btn-ghost'}`} onClick={()=>setSelectedPool(selectedPool===p?null:p)}>{p}</button>
        ))}
      </div>
      {selectedPool&&<PoolInspector poolId={selectedPool} userCerts={userCerts}/>}

      <hr className="divider"/>

      <div className="slbl mb8">ACTIVE GRANTS FROM PORTFOLIO ({active.length})</div>
      {active.length===0&&<div className="ban ban-y">No active cross-grants. Add CISSP, CISM, cloud certs to unlock CE cascades.</div>}
      {active.map((x,i)=>{
        const td=gd(x.from);
        const affected=userCerts.filter(uc=>gd(uc.defId)?.pools?.includes(x.pool)).map(uc=>gd(uc.defId)?.n).filter(Boolean);
        return (
          <div key={i} className="xrow xa">
            <span><span className="ct">{td?.n}</span><br/><span className="tiny cd mono">{td?.v}</span></span>
            <div className="xarrow">‚Üí</div>
            <span className="cp xs">{x.pool}{affected.length?<><br/><span className="tiny ct">{affected.join(', ')}</span></>:''}</span>
            <span className="ct bold mono xs">{x.cr>=999?'Full':`+${x.cr} CE`}<br/><span className="tiny cd">{x.cond}</span></span>
          </div>
        );
      })}

      {fromTgts.length>0&&<>
        <div className="slbl mt16 mb8">FROM TARGETS ‚Äî PENDING ({fromTgts.length})</div>
        {fromTgts.map((x,i)=>{
          const td=gd(x.from);
          const affected=userCerts.filter(uc=>gd(uc.defId)?.pools?.includes(x.pool)).map(uc=>gd(uc.defId)?.n).filter(Boolean);
          return (
            <div key={i} className="xrow xt">
              <span><span className="ca">{td?.n}</span><br/><span className="tiny cd mono">{td?.v}</span></span>
              <div className="xarrow">‚Üí</div>
              <span className="cp xs">{x.pool}{affected.length?<><br/><span className="tiny ca">Will help: {affected.join(', ')}</span></>:''}</span>
              <span className="ca bold mono xs">{x.cr>=999?'Full':`+${x.cr}`}</span>
            </div>
          );
        })}
      </>}

      <div className="slbl mt16 mb8">EXAM SUBSTITUTION CHAINS</div>
      {SUBS.map((sub,i)=>{
        const def=gd(sub.exam);const isH=held.has(sub.exam);const isT=tgts.has(sub.exam);
        return (
          <div key={i} className={`xrow ${isH?'xa':isT?'xt':''}`} style={{opacity:isH||isT?1:.35}}>
            <span style={{color:isH?'var(--violet)':isT?'var(--amber)':'var(--d2)'}}>{def?.n}</span>
            <div className="xarrow" style={{color:'var(--violet)'}}>‚üπ</div>
            <span className="cp tiny mono">{sub.renews.map(id=>gd(id)?.n).filter(Boolean).join(', ')}</span>
            <span>{isH?<span className="pill pv">ACTIVE</span>:isT?<span className="pill pa">TARGETED</span>:<span className="tiny cd">‚Äî</span>}</span>
          </div>
        );
      })}
    </div>
  );
}

// ‚îÄ‚îÄ TIMELINE
function TimelineView({userCerts}) {
  const dated=userCerts.filter(uc=>gd(uc.defId)&&!gd(uc.defId).nx&&uc.exp).sort((a,b)=>new Date(a.exp)-new Date(b.exp));
  const noExp=userCerts.filter(uc=>gd(uc.defId)?.nx);
  const maxD=365*5;
  if(!userCerts.length)return<div className="content-pad"><div className="empty"><div className="empty-icon">üìÖ</div><div className="empty-msg">No certs yet.</div></div></div>;
  return (
    <div className="content-pad">
      <div className="sh mb12"><span className="slbl">Expiry Timeline ‚Äî 5 Year View</span></div>
      <div className="card">
        <div className="flex g12 mb12 fw">
          {[['var(--teal)','Current'],['var(--gold)','Expiring <6mo'],['var(--red)','Expired']].map(([c,l])=>(
            <span key={l} className="flex fac g6 tiny mono cd">
              <span style={{width:7,height:7,borderRadius:1,background:c,display:'inline-block'}}/>
              {l}
            </span>
          ))}
        </div>
        {dated.map(uc=>{
          const def=gd(uc.defId);const s=getStatus(uc);const days=getDays(uc);
          const w=days>0?Math.min(100,(days/maxD)*100):2;
          const col=s==='x'?'var(--red)':s==='e'?'var(--gold)':'var(--teal)';
          return (
            <div key={uc.id} className="tlrow">
              <div className="tlname">{def?.n}</div>
              <div className="tlbar"><div className="tlfill" style={{width:`${w}%`,background:col}}/></div>
              <div className="tldays" style={{color:col}}>{days===null?'‚Äî':days>0?`${days}d`:'EXP'}</div>
            </div>
          );
        })}
        {noExp.length>0&&(
          <div style={{marginTop:12,paddingTop:10,borderTop:'1px solid var(--w1)'}}>
            <div className="slbl mb6">NON-EXPIRING</div>
            <div className="flex fw g4">{noExp.map(uc=><span key={uc.id} className="tag tteal">{gd(uc.defId)?.n}</span>)}</div>
          </div>
        )}
      </div>
    </div>
  );
}

// ‚îÄ‚îÄ DOD OVERLAY
function DoDView({userCerts,targetIds,setTargetIds}) {
  const held=new Set(userCerts.map(u=>u.defId));
  const onTarget=id=>{if(!targetIds.includes(id))setTargetIds(p=>[...p,id]);};
  return (
    <div className="content-pad">
      <div className="sh"><span className="slbl">DoD 8570 / 8140 Compliance</span></div>
      <div className="ban ban-s mb12">DoD Directive 8570 requires IAT/IAM role-based certifications for all personnel with privileged access to DoD information systems. Green = you hold it, grey = needed.</div>
      <div className="dod-grid">
        {Object.entries(DOD).map(([level,certs])=>{
          const heldCount=certs.filter(id=>held.has(id)).length;
          const pct=certs.length>0?Math.round((heldCount/certs.length)*100):0;
          return (
            <div key={level} className="dod-card">
              <div className="dod-level">{level} ‚Äî {heldCount}/{certs.length}</div>
              <div className="cc-bar mb8"><div className="cc-fill" style={{width:`${pct}%`,background:pct===100?'var(--teal)':pct>50?'var(--gold)':'var(--red)'}}/></div>
              {certs.map(id=>{
                const def=gd(id);const isH=held.has(id);
                const isTgt=targetIds.includes(id);
                return (
                  <div key={id} className="dod-cert-row">
                    <span style={{color:isH?'var(--d5)':'var(--d2)',textDecoration:isH?'none':'none'}}>{def?.n}</span>
                    <span style={{display:'flex',alignItems:'center',gap:4}}>
                      {isH ? <span style={{color:'var(--teal)'}}>‚úì</span> :
                        isTgt ? <span className="pill pv">TARGETED</span> :
                        <button className="btn btn-xs btn-ghost" onClick={()=>onTarget&&onTarget(id)}>+ Target</button>}
                    </span>
                  </div>
                );
              })}
            </div>
          );
        })}
      </div>
      <hr className="divider"/>
      <div className="ban ban-c">IAT = Information Assurance Technical. IAM = Information Assurance Management. Higher levels require lower-level certs first. CISSP satisfies IAT-III and IAM-II/III.</div>
    </div>
  );
}

// ‚îÄ‚îÄ DATA
function DataView({userCerts,setUserCerts,customActs,setCustomActs}) {
  const [showForm,setShowForm]=useState(false);
  const [name,setName]=useState('');const[cost,setCost]=useState('0');
  const [rows,setRows]=useState([{pool:'',cr:''}]);
  const pools=[...new Set(CERTS.flatMap(d=>d.pools))].sort();

  const exp=type=>{
    let blob,fn;
    if(type==='json'){blob=new Blob([JSON.stringify({v:5,ts:new Date().toISOString(),certs:userCerts,customActs},null,2)],{type:'application/json'});fn='certpath.json';}
    else{
      const r2=[['id','name','vendor','expiry','ceEarned','ceRequired','cost','status','daysLeft','notes']];
      for(const uc of userCerts){const d=gd(uc.defId);if(!d)continue;r2.push([uc.defId,d.n,d.v,uc.exp||'',uc.ceE||0,d.ce,d.$,getStatus(uc),getDays(uc)??'',uc.notes||'']);}
      blob=new Blob([r2.map(r=>r.map(v=>`"${v}"`).join(',')).join('\n')],{type:'text/csv'});fn='certpath.csv';
    }
    const a=document.createElement('a');a.href=URL.createObjectURL(blob);a.download=fn;document.body.appendChild(a);a.click();document.body.removeChild(a);
  };

  const imp=e=>{
    const f=e.target.files[0];if(!f)return;
    const r=new FileReader();
    r.onload=ev=>{try{
      const d=JSON.parse(ev.target.result);
      const mapped=(d.certs||[]).map(uc=>({...uc,exp:uc.exp||uc.expiryDate||'',ceE:uc.ceE??uc.ceEarned??0}));
      if(mapped.length)setUserCerts(mapped);
      if(d.customActs)setCustomActs(d.customActs);
    }catch{alert('Invalid JSON');}};
    r.readAsText(f);e.target.value='';
  };

  const addCustom=()=>{
    const g={};for(const row of rows){if(row.pool&&row.cr)g[row.pool]=parseInt(row.cr)||0;}
    if(!name||!Object.keys(g).length)return;
    setCustomActs(p=>[...p,{id:Date.now().toString(),n:name,$:parseInt(cost)||0,g}]);
    setShowForm(false);setName('');setCost('0');setRows([{pool:'',cr:''}]);
  };

  return (
    <div className="content-pad">
      <div className="slbl mb10">IMPORT / EXPORT</div>
      <div className="ban ban-y">No server storage. Export regularly ‚Äî clearing browser data wipes your portfolio.</div>
      <div style={{display:'grid',gridTemplateColumns:'1fr 1fr',gap:9,marginBottom:14,marginTop:12}}>
        <div className="card2">
          <div className="slbl mb8">EXPORT</div>
          <div style={{display:'flex',flexDirection:'column',gap:5}}>
            <button className="btn btn-teal w100" onClick={()=>exp('json')}>Export JSON</button>
            <button className="btn btn-ghost w100" onClick={()=>exp('csv')}>Export CSV</button>
          </div>
        </div>
        <div className="card2">
          <div className="slbl mb8">IMPORT</div>
          <div style={{display:'flex',flexDirection:'column',gap:5}}>
            <label className="btn btn-ghost w100" style={{cursor:'pointer',justifyContent:'center'}}>Import JSON<input type="file" accept=".json" onChange={imp} style={{display:'none'}}/></label>
            <button className="btn btn-red w100" onClick={()=>{if(confirm('Clear all?')){setUserCerts([]);setCustomActs([]);}}}>Clear All</button>
          </div>
        </div>
      </div>

      <div className="card2 mb12">
        <div className="flex fac sb mb8">
          <div className="slbl">CUSTOM CE ACTIVITIES ({customActs.length})</div>
          <button className="btn btn-ghost btn-sm" onClick={()=>setShowForm(p=>!p)}>+ Add</button>
        </div>
        {showForm&&(
          <div className="card2 mb8">
            <div className="fg"><label className="fl">Name</label><input className="fi" value={name} onChange={e=>setName(e.target.value)} placeholder="e.g. Internal Security Training"/></div>
            <div className="fg"><label className="fl">Cost ($)</label><input type="number" className="fi" value={cost} onChange={e=>setCost(e.target.value)} min="0"/></div>
            {rows.map((row,i)=>(
              <div key={i} style={{display:'grid',gridTemplateColumns:'1fr 70px 24px',gap:4,marginBottom:4}}>
                <select className="fsel" value={row.pool} onChange={e=>setRows(r=>r.map((x,j)=>j===i?{...x,pool:e.target.value}:x))}>
                  <option value="">‚Äî Pool ‚Äî</option>
                  {pools.map(p=><option key={p} value={p}>{p}</option>)}
                </select>
                <input type="number" className="fi" placeholder="Credits" value={row.cr} onChange={e=>setRows(r=>r.map((x,j)=>j===i?{...x,cr:e.target.value}:x))} min="1"/>
                <button className="btn btn-red btn-xs" onClick={()=>setRows(r=>r.filter((_,j)=>j!==i))}>‚úï</button>
              </div>
            ))}
            <div className="flex g6 mt8 sb">
              <button className="btn btn-ghost btn-xs" onClick={()=>setRows(r=>[...r,{pool:'',cr:''}])}>+ Pool</button>
              <div className="flex g6"><button className="btn btn-ghost btn-sm" onClick={()=>setShowForm(false)}>Cancel</button><button className="btn btn-teal btn-sm" onClick={addCustom}>Add</button></div>
            </div>
          </div>
        )}
        {customActs.length===0?<div className="tiny cd mono">No custom activities yet.</div>:
          customActs.map((a,i)=>(
            <div key={i} style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'5px 0',borderBottom:'1px solid var(--w1)'}}>
              <span className="mono xs">{a.n} <span className="cd">‚Äî {fc(a.$)}</span></span>
              <button className="btn btn-red btn-xs" onClick={()=>setCustomActs(p=>p.filter((_,j)=>j!==i))}>Remove</button>
            </div>
          ))
        }
      </div>
      <div className="card2">
        <div className="slbl mb6">KNOWLEDGE BASE</div>
        <div className="tiny cm" style={{lineHeight:1.8,marginBottom:7}}>{CERTS.length} certs ¬∑ {[...new Set(CERTS.map(d=>d.v))].length} vendors ¬∑ {XG.length} cross-grant policies ¬∑ {SUBS.length} exam-sub rules ¬∑ {ACTS.length} catalog activities ¬∑ {TRACKS.length} career tracks ¬∑ {Object.keys(DOD).length} DoD roles</div>
        <div className="flex fw g4">{[...new Set(CERTS.map(d=>d.v))].sort().map(b=><span key={b} className="tag tgrey">{b} ({CERTS.filter(d=>d.v===b).length})</span>)}</div>
      </div>
    </div>
  );
}

// ‚îÄ‚îÄ OPTIMIZER (mobile inline view)
function OptimizerView({userCerts,targetIds,customActs}) {
  const res=useMemo(()=>optimize(userCerts,targetIds,customActs),[userCerts,targetIds,customActs]);
  const tc={auto:'var(--teal)',free:'var(--teal)',ce:'var(--sky)',exam:'var(--violet)',newcert:'var(--amber)'};
  const tl={auto:'AUTO',free:'FREE',ce:'CE',exam:'EXAM',newcert:'NEW'};
  return (
    <div className="content-pad">
      <div className="sh"><span className="slbl">Optimizer ‚Äî Fastest Path Plan</span></div>
      <div style={{display:'grid',gridTemplateColumns:'repeat(4,1fr)',gap:7,marginBottom:14}}>
        {[['Total Cost',res.total===0?'FREE':'$'+res.total.toLocaleString(),'var(--gold)'],['Actions',res.steps.length,'var(--d5)'],['Recerts Needed',res.needsRecert,'var(--gold)'],['New Certs',res.newCerts,'var(--violet)']].map(([l,v,c])=>(
          <div key={l} className="card2" style={{textAlign:'center'}}>
            <div className="mono bold" style={{fontSize:16,color:c,lineHeight:1}}>{v}</div>
            <div className="tiny cd mono" style={{marginTop:3}}>{l}</div>
          </div>
        ))}
      </div>
      {/* Renewal timeline alerts */}
      {(()=>{
        const soon=userCerts.filter(uc=>{
          const d=getDays(uc);const def=gd(uc.defId);
          return def&&!def.nx&&d!==null&&d>=0&&d<365;
        }).sort((a,b)=>(getDays(a)||0)-(getDays(b)||0));
        if(!soon.length) return null;
        return (
          <div className="card2 mb12" style={{borderColor:'var(--goldb)'}}>
            <div className="slbl mb8" style={{color:'var(--gold)'}}>‚ö† RENEWAL NEEDED WITHIN 12 MONTHS</div>
            {soon.map(uc=>{
              const def=gd(uc.defId);const days=getDays(uc);
              return (
                <div key={uc.id} style={{display:'flex',justifyContent:'space-between',alignItems:'center',padding:'5px 0',borderBottom:'1px solid var(--w1)'}}>
                  <div>
                    <span style={{fontSize:11,fontWeight:600}}>{def.n}</span>
                    <span className="mono tiny cd" style={{marginLeft:6}}>{def.v}</span>
                  </div>
                  <span className="mono xs" style={{color:days<90?'var(--red)':'var(--gold)',fontWeight:700}}>{days}d</span>
                </div>
              );
            })}
          </div>
        );
      })()}
      {res.steps.length===0?(
        <div className="ban ban-ok">All certs current. No recert actions needed. Select targets in Roadmap to plan acquisitions. Use Recommendations to pick a starting path.</div>
      ):(
        <>
          <div className="ban ban-c mb12">Ordered for minimum cost, maximum CE coverage. Free activities first. Cross-vendor CE bonuses pre-applied.</div>
          {res.steps.map((step,i)=>(
            <div key={i} style={{display:'flex',gap:10,padding:11,background:'var(--s2)',border:'1px solid var(--w1)',borderRadius:'var(--r-sm)',marginBottom:7,position:'relative',overflow:'hidden'}}>
              <div style={{position:'absolute',top:0,left:0,bottom:0,width:2,background:tc[step.type]||'var(--w2)'}}/>
              <div style={{paddingLeft:6,flex:1}}>
                <div className="mono tiny" style={{color:tc[step.type],fontWeight:700,marginBottom:3}}>{tl[step.type]||i+1}</div>
                <div style={{fontWeight:600,fontSize:12,marginBottom:3}}>{step.title}</div>
                <div className="mono" style={{fontSize:11,color:step.cost===0?'var(--teal)':'var(--gold)',fontWeight:700}}>{step.cost===0?'FREE':'$'+step.cost.toLocaleString()}</div>
                {step.covers?.length>0&&<div className="flex fw g4 mt8">{step.covers.map(id=><span key={id} className="tag tteal">{gd(id)?.n||id}</span>)}</div>}
                {step.cascade?.slice(0,2).map((c,j)=>(
                  <div key={j} className="tiny mono mt8" style={{color:c.type==='sub'?'var(--violet)':'var(--teal)'}}>
                    {c.type==='sub'?'‚üπ':'‚Üó'} {c.name||c.pool}
                  </div>
                ))}
              </div>
            </div>
          ))}
        </>
      )}
    </div>
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// SIDEBAR COMPONENT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function Sidebar({userCerts,onAddCert,onEditCert}) {
  const total=userCerts.length;
  const statuses=userCerts.map(getStatus);
  const cur=statuses.filter(s=>s==='c').length;
  const exp=statuses.filter(s=>s==='e').length;
  const xp=statuses.filter(s=>s==='x').length;
  const health=total>0?Math.round((cur/total)*100):0;
  const hColor=health>=80?'var(--teal)':health>=50?'var(--gold)':'var(--red)';
  const r=26;const circ=2*Math.PI*r;const dash=(health/100)*circ;

  const sorted=[...userCerts].sort((a,b)=>(getDays(a)??Infinity)-(getDays(b)??Infinity)).slice(0,9);

  return (
    <aside className="sidebar">
      <div className="sb-sect">
        <div className="sb-lbl">Portfolio Health</div>
        <div className="ring-wrap">
          <div className="ring-box">
            <svg width="60" height="60" viewBox="0 0 60 60">
              <circle cx="30" cy="30" r={r} fill="none" stroke="var(--w1)" strokeWidth="5"/>
              <circle cx="30" cy="30" r={r} fill="none" stroke={hColor} strokeWidth="5"
                strokeDasharray={`${dash} ${circ-dash}`} strokeLinecap="round"
                style={{transform:'rotate(-90deg)',transformOrigin:'30px 30px',transition:'stroke-dasharray .5s'}}/>
            </svg>
            <div className="ring-inner">
              <span className="ring-pct" style={{color:hColor}}>{health}%</span>
              <span className="ring-sub">HEALTH</span>
            </div>
          </div>
          <div className="qgrid">
            <div className="qcell"><div className="qval ct">{total}</div><div className="qlbl">Total</div></div>
            <div className="qcell"><div className="qval" style={{color:hColor}}>{cur}</div><div className="qlbl">Current</div></div>
            <div className="qcell"><div className="qval cy">{exp}</div><div className="qlbl">Expiring</div></div>
            <div className="qcell"><div className="qval cr">{xp}</div><div className="qlbl">Expired</div></div>
          </div>
        </div>
      </div>

      {sorted.length>0&&(
        <div className="sb-sect" style={{flex:1,overflowY:'auto'}}>
          <div className="sb-lbl">By Urgency</div>
          {sorted.map(uc=>{
            const def=gd(uc.defId);if(!def)return null;
            const s=getStatus(uc);const days=getDays(uc);
            return (
              <div key={uc.id} className="mc" onClick={()=>onEditCert(uc)}>
                <div className="mc-dot" style={{background:sColor[s]}}/>
                <div className="mc-name">{def.n}</div>
                <ArcRing days={days} cy={def.cy} size={20} sw={2}/>
                <div className="mc-days" style={{color:sColor[s]}}>
                  {def.nx?'‚àû':days===null?'?':days>365?Math.floor(days/365)+'y':days>0?days+'d':'EXP'}
                </div>
              </div>
            );
          })}
        </div>
      )}

      <button className="add-btn" onClick={onAddCert}>Ôºã Add Certification</button>
    </aside>
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// OPTIMIZER DRAWER (desktop)
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function OptimizerDrawer({userCerts,targetIds,customActs}) {
  const [open,setOpen]=useState(true);
  const res=useMemo(()=>optimize(userCerts,targetIds,customActs),[userCerts,targetIds,customActs]);
  const tc={auto:'var(--teal)',free:'var(--teal)',ce:'var(--sky)',exam:'var(--violet)',newcert:'var(--amber)'};
  const tl={auto:'AUTO',free:'FREE',ce:'CE',exam:'EXAM',newcert:'NEW'};

  return (
    <div className="drawer" style={{height:open?260:36,flexShrink:0}}>
      <div className="drawer-hdr" onClick={()=>setOpen(p=>!p)}>
        <span className="drawer-title">‚öô OPTIMIZER ‚Äî {res.steps.length} actions</span>
        <div className="flex fac g12">
          {res.needsRecert>0&&<span className="tiny mono cy">{res.needsRecert} recert</span>}
          {res.newCerts>0&&<span className="tiny mono cv">{res.newCerts} new</span>}
          <span className="drawer-cost" style={{color:res.total===0?'var(--teal)':'var(--gold)'}}>{res.total===0?'FREE':'$'+res.total.toLocaleString()}</span>
        </div>
        <span className="drawer-toggle">{open?'‚ñº':'‚ñ≤'}</span>
      </div>
      {open&&(
        <div className="drawer-body">
          {res.steps.length===0?(
            <div className="drawer-empty">All certs current. Select targets in Roadmap to plan acquisitions.</div>
          ):(
            res.steps.map((step,i)=>(
              <div key={i} className={`ds t-${step.type}`}>
                <div className="ds-typ" style={{color:tc[step.type]}}>{tl[step.type]}</div>
                <div className="ds-title">{step.title}</div>
                <div className="ds-cost" style={{color:step.cost===0?'var(--teal)':'var(--gold)'}}>{step.cost===0?'FREE':'$'+step.cost.toLocaleString()}</div>
                {step.covers?.length>0&&<div className="ds-chips">{step.covers.map(id=><span key={id} className="ds-chip">{gd(id)?.n||id}</span>)}</div>}
              </div>
            ))
          )}
        </div>
      )}
    </div>
  );
}

// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
// APP ROOT
// ‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê‚ïê
function App() {
  const load=(k,d)=>{try{return JSON.parse(localStorage.getItem(k)||'null')??d;}catch{return d;}};
  const [view,setView]=useState('recs');
  const [userCerts,setUserCerts]=useState(()=>load('cp5-certs',[]));
  const [targetIds,setTargetIds]=useState(()=>load('cp5-targets',[]));
  const [customActs,setCustomActs]=useState(()=>load('cp5-custom',[]));
  const [showAdd,setShowAdd]=useState(false);
  const [editingCert,setEditingCert]=useState(null);

  // Migrate from v4 keys
  useEffect(()=>{
    const v4=localStorage.getItem('cp4-certs');
    if(v4&&!localStorage.getItem('cp5-certs')){
      try{const d=JSON.parse(v4);if(d.length){setUserCerts(d);}}catch{}
    }
  },[]);

  useEffect(()=>localStorage.setItem('cp5-certs',JSON.stringify(userCerts)),[userCerts]);
  useEffect(()=>localStorage.setItem('cp5-targets',JSON.stringify(targetIds)),[targetIds]);
  useEffect(()=>localStorage.setItem('cp5-custom',JSON.stringify(customActs)),[customActs]);

  const saveCert=c=>setUserCerts(p=>p.some(u=>u.id===c.id)?p.map(u=>u.id===c.id?c:u):[...p,c]);
  const delCert=id=>setUserCerts(p=>p.filter(u=>u.id!==id));

  const alertN=userCerts.filter(uc=>['e','x'].includes(getStatus(uc))).length;
  const urgent=userCerts.filter(uc=>{const d=getDays(uc);return d!==null&&d>=0&&d<90;});

  const VIEWS=[
    {id:'recs',   label:'RECS',    icon:'‚≠ê',full:'RECOMMENDATIONS'},
    {id:'portfolio',label:'CERTS', icon:'üèÖ',full:'PORTFOLIO'},
    {id:'roadmap',label:'ROADMAP', icon:'üó∫Ô∏è',full:'ROADMAP'},
    {id:'cross',  label:'NETWORK', icon:'üï∏Ô∏è',full:'CROSS-GRANTS'},
    {id:'dod',    label:'DOD',     icon:'üéñÔ∏è',full:'DOD 8570'},
    {id:'optimizer',label:'PLAN',  icon:'‚öôÔ∏è',full:'OPTIMIZER'},
  ];

  return (
    <div className="app">
      {/* HEADER */}
      <header className="hdr">
        <div className="logo">CERT<span>PATH</span></div>
        <nav className="desk-nav">
          {[...VIEWS,{id:'timeline',label:'TIMELINE',icon:'üìÖ',full:'TIMELINE'},{id:'data',label:'DATA',icon:'üíæ',full:'DATA'}].map(v=>(
            <button key={v.id} className={`dnav-btn ${view===v.id?'on':''}`} onClick={()=>setView(v.id)}>
              {v.full}
              {v.id==='portfolio'&&alertN>0&&<span className="npill" style={{background:'var(--gold)',color:'var(--bg)'}}>{alertN}</span>}
              {v.id==='roadmap'&&targetIds.length>0&&<span className="npill" style={{background:'var(--violet)',color:'var(--bg)'}}>{targetIds.length}</span>}
            </button>
          ))}
        </nav>
        <div className="hdr-right">
          <div className="hdr-stat">{userCerts.length} cert{userCerts.length!==1?'s':''}{alertN>0&&<span className="cy"> ¬∑ {alertN} urgent</span>}{targetIds.length>0&&<span style={{color:'var(--violet)'}}> ¬∑ {targetIds.length} targeted</span>}</div>
          <button className="btn btn-teal btn-sm" onClick={()=>setShowAdd(true)}>Ôºã Add</button>
        </div>
      </header>

      {/* URGENCY BANNER */}
      {urgent.length>0&&(
        <div className="urgency">
          <div className="urgency-dot"/>
          <span>{urgent.length} cert{urgent.length>1?'s':''} expiring within 90 days: {urgent.map(uc=>gd(uc.defId)?.n).filter(Boolean).slice(0,3).join(', ')}{urgent.length>3?` +${urgent.length-3} more`:''}</span>
        </div>
      )}

      {/* BODY */}
      <div className="body-wrap">
        <Sidebar userCerts={userCerts} onAddCert={()=>setShowAdd(true)} onEditCert={uc=>setEditingCert(uc)}/>

        <main className="content">
          {view==='recs'      &&<RecsView       userCerts={userCerts} targetIds={targetIds} setTargetIds={setTargetIds}/>}
          {view==='portfolio' &&<PortfolioView   userCerts={userCerts} setUserCerts={setUserCerts}/>}
          {view==='roadmap'   &&<RoadmapView     userCerts={userCerts} targetIds={targetIds} setTargetIds={setTargetIds}/>}
          {view==='cross'     &&<CrossView       userCerts={userCerts} targetIds={targetIds}/>}
          {view==='dod'       &&<DoDView         userCerts={userCerts} targetIds={targetIds} setTargetIds={setTargetIds}/>}
          {view==='optimizer' &&<OptimizerView   userCerts={userCerts} targetIds={targetIds} customActs={customActs}/>}
          {view==='timeline'  &&<TimelineView    userCerts={userCerts}/>}
          {view==='data'      &&<DataView        userCerts={userCerts} setUserCerts={setUserCerts} customActs={customActs} setCustomActs={setCustomActs}/>}
        </main>

      </div>

      {/* DESKTOP OPTIMIZER DRAWER */}
      <OptimizerDrawer userCerts={userCerts} targetIds={targetIds} customActs={customActs}/>

      {/* MOBILE BOTTOM NAV - all views, scrollable */}
      <nav className="mob-nav">
        {[...VIEWS,{id:'timeline',label:'TIME',icon:'üìÖ',full:'TIMELINE'},{id:'data',label:'DATA',icon:'üíæ',full:'DATA'}].map(v=>(
          <button key={v.id} className={`mob-btn ${view===v.id?'on':''}`} onClick={()=>setView(v.id)}>
            {v.id==='portfolio'&&alertN>0&&<div className="mob-badge" style={{background:'var(--gold)',color:'var(--bg)'}}>{alertN}</div>}
            {v.id==='roadmap'&&targetIds.length>0&&<div className="mob-badge" style={{background:'var(--violet)',color:'var(--bg)'}}>{targetIds.length}</div>}
            <span className="mob-icon">{v.icon}</span>
            <span className="mob-label">{v.label}</span>
          </button>
        ))}
      </nav>

      {/* MOBILE FAB */}
      <button className="mob-add-btn" onClick={()=>setShowAdd(true)}>Ôºã</button>

      {/* MODALS */}
      {showAdd&&<CertModal onClose={()=>setShowAdd(false)} onSave={saveCert} onDelete={delCert}/>}
      {editingCert&&<CertModal existing={editingCert} onClose={()=>setEditingCert(null)} onSave={saveCert} onDelete={delCert}/>}
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App/>);
</script>
</body>
</html>
