<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>CertPath ‚Äî Recertification Optimizer</title>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react/18.2.0/umd/react.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/react-dom/18.2.0/umd/react-dom.production.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/babel-standalone/7.23.2/babel.min.js"></script>
<link href="https://fonts.googleapis.com/css2?family=JetBrains+Mono:wght@300;400;500;700&family=DM+Sans:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #0a0c0f;
    --surface: #111418;
    --surface2: #181c22;
    --border: #1e2530;
    --border2: #252d3a;
    --accent: #00d4ff;
    --accent2: #0097b8;
    --green: #00e676;
    --yellow: #ffd600;
    --red: #ff4444;
    --text: #e8edf5;
    --text2: #8899aa;
    --text3: #4a5568;
    --mono: 'JetBrains Mono', monospace;
    --sans: 'DM Sans', sans-serif;
  }
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
  html, body { height: 100%; background: var(--bg); color: var(--text); font-family: var(--sans); font-size: 14px; }
  #root { height: 100%; display: flex; flex-direction: column; }

  /* Layout */
  .app { display: flex; flex-direction: column; height: 100vh; overflow: hidden; }
  .topbar { display: flex; align-items: center; justify-content: space-between; padding: 0 24px; height: 52px; background: var(--surface); border-bottom: 1px solid var(--border); flex-shrink: 0; }
  .logo { font-family: var(--mono); font-weight: 700; font-size: 15px; color: var(--accent); letter-spacing: -0.5px; }
  .logo span { color: var(--text2); font-weight: 300; }
  .tabs { display: flex; gap: 2px; }
  .tab { padding: 6px 14px; font-family: var(--mono); font-size: 12px; font-weight: 500; color: var(--text2); background: transparent; border: 1px solid transparent; border-radius: 4px; cursor: pointer; transition: all 0.15s; letter-spacing: 0.3px; }
  .tab:hover { color: var(--text); background: var(--surface2); }
  .tab.active { color: var(--accent); border-color: var(--border2); background: var(--surface2); }
  .topbar-actions { display: flex; gap: 8px; }

  .main { flex: 1; overflow-y: auto; padding: 24px; }

  /* Buttons */
  .btn { display: inline-flex; align-items: center; gap: 6px; padding: 7px 14px; font-family: var(--mono); font-size: 12px; font-weight: 500; border-radius: 4px; cursor: pointer; transition: all 0.15s; border: none; letter-spacing: 0.3px; }
  .btn-primary { background: var(--accent); color: #000; }
  .btn-primary:hover { background: #1ae0ff; }
  .btn-ghost { background: transparent; color: var(--text2); border: 1px solid var(--border2); }
  .btn-ghost:hover { color: var(--text); border-color: var(--text3); }
  .btn-danger { background: transparent; color: var(--red); border: 1px solid #ff444433; }
  .btn-danger:hover { background: #ff444411; }
  .btn-sm { padding: 4px 10px; font-size: 11px; }
  .btn-green { background: var(--green); color: #000; }
  .btn-green:hover { background: #33ff8e; }

  /* Cards */
  .card { background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 20px; }
  .card-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
  .card-title { font-family: var(--mono); font-size: 12px; font-weight: 500; color: var(--text2); text-transform: uppercase; letter-spacing: 1px; }

  /* Grid */
  .grid-2 { display: grid; grid-template-columns: 1fr 1fr; gap: 16px; }
  .grid-3 { display: grid; grid-template-columns: repeat(3, 1fr); gap: 16px; }

  /* Cert cards */
  .cert-grid { display: grid; grid-template-columns: repeat(auto-fill, minmax(280px, 1fr)); gap: 12px; }
  .cert-card { background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 16px; position: relative; overflow: hidden; transition: border-color 0.15s; }
  .cert-card:hover { border-color: var(--border2); }
  .cert-card::before { content: ''; position: absolute; top: 0; left: 0; right: 0; height: 2px; }
  .cert-card.status-current::before { background: var(--green); }
  .cert-card.status-expiring::before { background: var(--yellow); }
  .cert-card.status-expired::before { background: var(--red); }
  .cert-card.status-unknown::before { background: var(--text3); }
  .cert-name { font-family: var(--mono); font-size: 13px; font-weight: 700; color: var(--text); margin-bottom: 4px; }
  .cert-body { font-size: 11px; color: var(--text2); margin-bottom: 12px; }
  .cert-meta { display: flex; flex-direction: column; gap: 4px; }
  .cert-meta-row { display: flex; justify-content: space-between; font-size: 11px; }
  .cert-meta-label { color: var(--text3); font-family: var(--mono); }
  .cert-meta-value { color: var(--text2); font-family: var(--mono); }
  .cert-actions { display: flex; gap: 6px; margin-top: 12px; }
  .status-badge { display: inline-flex; align-items: center; gap: 4px; padding: 2px 8px; border-radius: 3px; font-family: var(--mono); font-size: 10px; font-weight: 500; }
  .status-badge.current { background: #00e67611; color: var(--green); }
  .status-badge.expiring { background: #ffd60011; color: var(--yellow); }
  .status-badge.expired { background: #ff444411; color: var(--red); }
  .status-badge.unknown { background: #ffffff0a; color: var(--text3); }

  /* Timeline */
  .timeline { display: flex; flex-direction: column; gap: 2px; }
  .timeline-row { display: grid; grid-template-columns: 200px 1fr 80px; align-items: center; gap: 12px; padding: 8px 0; border-bottom: 1px solid var(--border); }
  .timeline-label { font-family: var(--mono); font-size: 11px; color: var(--text2); white-space: nowrap; overflow: hidden; text-overflow: ellipsis; }
  .timeline-bar-wrap { position: relative; height: 8px; background: var(--surface2); border-radius: 4px; overflow: hidden; }
  .timeline-bar { position: absolute; left: 0; top: 0; height: 100%; border-radius: 4px; }
  .timeline-days { font-family: var(--mono); font-size: 10px; color: var(--text3); text-align: right; }

  /* Optimizer */
  .opt-step { display: flex; gap: 16px; padding: 16px; background: var(--surface2); border: 1px solid var(--border); border-radius: 6px; margin-bottom: 8px; }
  .opt-step-num { width: 28px; height: 28px; border-radius: 50%; background: var(--accent); color: #000; font-family: var(--mono); font-size: 12px; font-weight: 700; display: flex; align-items: center; justify-content: center; flex-shrink: 0; }
  .opt-step-body { flex: 1; }
  .opt-step-title { font-family: var(--mono); font-size: 13px; font-weight: 500; color: var(--text); margin-bottom: 4px; }
  .opt-step-desc { font-size: 12px; color: var(--text2); line-height: 1.5; }
  .opt-step-meta { display: flex; gap: 12px; margin-top: 8px; }
  .opt-step-cost { font-family: var(--mono); font-size: 12px; color: var(--green); }
  .opt-step-covers { font-size: 11px; color: var(--text3); }
  .opt-tag { display: inline-block; padding: 2px 6px; background: var(--accent)18; border: 1px solid var(--accent)33; border-radius: 3px; font-family: var(--mono); font-size: 10px; color: var(--accent); margin: 2px; }

  /* Forms */
  .form-group { margin-bottom: 14px; }
  .form-label { display: block; font-family: var(--mono); font-size: 11px; color: var(--text2); margin-bottom: 6px; text-transform: uppercase; letter-spacing: 0.5px; }
  .form-input { width: 100%; padding: 8px 12px; background: var(--surface2); border: 1px solid var(--border2); border-radius: 4px; color: var(--text); font-family: var(--mono); font-size: 12px; outline: none; transition: border-color 0.15s; }
  .form-input:focus { border-color: var(--accent); }
  .form-input option { background: var(--surface2); }
  .form-select { width: 100%; padding: 8px 12px; background: var(--surface2); border: 1px solid var(--border2); border-radius: 4px; color: var(--text); font-family: var(--mono); font-size: 12px; outline: none; cursor: pointer; }
  .form-select:focus { border-color: var(--accent); }

  /* Modal */
  .modal-overlay { position: fixed; inset: 0; background: #000000cc; z-index: 100; display: flex; align-items: center; justify-content: center; }
  .modal { background: var(--surface); border: 1px solid var(--border2); border-radius: 10px; padding: 28px; width: 520px; max-width: 95vw; max-height: 85vh; overflow-y: auto; }
  .modal-title { font-family: var(--mono); font-size: 14px; font-weight: 700; color: var(--text); margin-bottom: 20px; }
  .modal-actions { display: flex; gap: 8px; justify-content: flex-end; margin-top: 20px; }

  /* Stats */
  .stat-card { background: var(--surface); border: 1px solid var(--border); border-radius: 8px; padding: 16px 20px; }
  .stat-value { font-family: var(--mono); font-size: 28px; font-weight: 700; color: var(--text); }
  .stat-label { font-family: var(--mono); font-size: 11px; color: var(--text3); text-transform: uppercase; letter-spacing: 0.5px; margin-top: 4px; }
  .stat-sub { font-family: var(--mono); font-size: 11px; color: var(--text2); margin-top: 2px; }

  /* Empty state */
  .empty { text-align: center; padding: 60px 20px; color: var(--text3); }
  .empty-icon { font-size: 40px; margin-bottom: 12px; }
  .empty-text { font-family: var(--mono); font-size: 13px; }

  /* Scrollbar */
  ::-webkit-scrollbar { width: 6px; }
  ::-webkit-scrollbar-track { background: transparent; }
  ::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 3px; }

  /* Misc */
  .section-header { display: flex; align-items: center; justify-content: space-between; margin-bottom: 16px; }
  .section-title { font-family: var(--mono); font-size: 11px; font-weight: 500; color: var(--text2); text-transform: uppercase; letter-spacing: 1px; }
  .divider { border: none; border-top: 1px solid var(--border); margin: 20px 0; }
  .text-mono { font-family: var(--mono); }
  .text-sm { font-size: 12px; }
  .text-xs { font-size: 11px; }
  .text-muted { color: var(--text2); }
  .text-dim { color: var(--text3); }
  .text-accent { color: var(--accent); }
  .text-green { color: var(--green); }
  .text-yellow { color: var(--yellow); }
  .text-red { color: var(--red); }
  .mt-8 { margin-top: 8px; }
  .mt-16 { margin-top: 16px; }
  .flex { display: flex; }
  .flex-col { flex-direction: column; }
  .items-center { align-items: center; }
  .gap-8 { gap: 8px; }
  .gap-12 { gap: 12px; }
  .w-full { width: 100%; }
  .summary-box { background: var(--surface2); border: 1px solid var(--border); border-radius: 6px; padding: 14px 16px; margin-bottom: 20px; display: flex; gap: 32px; align-items: center; }
  .summary-item { text-align: center; }
  .summary-value { font-family: var(--mono); font-size: 22px; font-weight: 700; }
  .summary-label { font-family: var(--mono); font-size: 10px; color: var(--text3); text-transform: uppercase; letter-spacing: 0.5px; margin-top: 2px; }
  .info-banner { background: #00d4ff0d; border: 1px solid #00d4ff22; border-radius: 6px; padding: 12px 16px; font-size: 12px; color: var(--text2); line-height: 1.5; margin-bottom: 16px; }
  .warn-banner { background: #ffd6000d; border: 1px solid #ffd60022; border-radius: 6px; padding: 12px 16px; font-size: 12px; color: var(--yellow); line-height: 1.5; margin-bottom: 16px; }
</style>
</head>
<body>
<div id="root"></div>
<script type="text/babel">
const { useState, useEffect, useMemo, useCallback } = React;

// ============================================================
// CERT KNOWLEDGE GRAPH
// ============================================================
const CERT_DB = [
  // CompTIA
  { id: 'comptia-aplus', body: 'CompTIA', name: 'A+', cycleYears: 3, examCost: 253, cePools: ['comptia-core'], ceRequired: 20, ceCategories: {}, satisfies: [] },
  { id: 'comptia-netplus', body: 'CompTIA', name: 'Network+', cycleYears: 3, examCost: 358, cePools: ['comptia-core', 'comptia-net'], ceRequired: 30, ceCategories: {}, satisfies: [] },
  { id: 'comptia-secplus', body: 'CompTIA', name: 'Security+', cycleYears: 3, examCost: 392, cePools: ['comptia-core', 'comptia-sec'], ceRequired: 50, ceCategories: {}, satisfies: ['comptia-aplus', 'comptia-netplus'] },
  { id: 'comptia-cysa', body: 'CompTIA', name: 'CySA+', cycleYears: 3, examCost: 392, cePools: ['comptia-sec', 'comptia-advanced'], ceRequired: 60, ceCategories: {}, satisfies: ['comptia-secplus'] },
  { id: 'comptia-pentest', body: 'CompTIA', name: 'PenTest+', cycleYears: 3, examCost: 392, cePools: ['comptia-sec', 'comptia-advanced'], ceRequired: 60, ceCategories: {}, satisfies: ['comptia-secplus'] },
  { id: 'comptia-casp', body: 'CompTIA', name: 'CASP+', cycleYears: 3, examCost: 494, cePools: ['comptia-advanced'], ceRequired: 75, ceCategories: {}, satisfies: ['comptia-secplus', 'comptia-cysa', 'comptia-pentest'] },
  { id: 'comptia-linux', body: 'CompTIA', name: 'Linux+', cycleYears: 3, examCost: 358, cePools: ['comptia-core', 'comptia-net'], ceRequired: 30, ceCategories: {}, satisfies: [] },
  { id: 'comptia-cloud', body: 'CompTIA', name: 'Cloud+', cycleYears: 3, examCost: 358, cePools: ['comptia-core', 'comptia-net'], ceRequired: 30, ceCategories: {}, satisfies: [] },
  { id: 'comptia-data', body: 'CompTIA', name: 'Data+', cycleYears: 3, examCost: 358, cePools: ['comptia-core'], ceRequired: 30, ceCategories: {}, satisfies: [] },
  // ISC2
  { id: 'isc2-cc', body: 'ISC¬≤', name: 'CC', cycleYears: 3, examCost: 0, cePools: ['isc2-cpe'], ceRequired: 45, ceCategories: {}, satisfies: [] },
  { id: 'isc2-sscp', body: 'ISC¬≤', name: 'SSCP', cycleYears: 3, examCost: 249, cePools: ['isc2-cpe'], ceRequired: 60, ceCategories: {}, satisfies: ['isc2-cc'] },
  { id: 'isc2-cissp', body: 'ISC¬≤', name: 'CISSP', cycleYears: 3, examCost: 749, cePools: ['isc2-cpe'], ceRequired: 120, ceCategories: { 'domain-specific': 40 }, satisfies: ['isc2-sscp', 'isc2-cc'] },
  { id: 'isc2-ccsp', body: 'ISC¬≤', name: 'CCSP', cycleYears: 3, examCost: 599, cePools: ['isc2-cpe'], ceRequired: 90, ceCategories: {}, satisfies: ['isc2-sscp', 'isc2-cc'] },
  { id: 'isc2-cap', body: 'ISC¬≤', name: 'CAP/CGRC', cycleYears: 3, examCost: 599, cePools: ['isc2-cpe'], ceRequired: 60, ceCategories: {}, satisfies: [] },
  { id: 'isc2-csslp', body: 'ISC¬≤', name: 'CSSLP', cycleYears: 3, examCost: 599, cePools: ['isc2-cpe'], ceRequired: 90, ceCategories: {}, satisfies: [] },
  // ISACA
  { id: 'isaca-cisa', body: 'ISACA', name: 'CISA', cycleYears: 3, examCost: 575, cePools: ['isaca-cpe'], ceRequired: 120, ceCategories: { 'general': 20 }, satisfies: [] },
  { id: 'isaca-cism', body: 'ISACA', name: 'CISM', cycleYears: 3, examCost: 575, cePools: ['isaca-cpe'], ceRequired: 120, ceCategories: { 'general': 20 }, satisfies: [] },
  { id: 'isaca-crisc', body: 'ISACA', name: 'CRISC', cycleYears: 3, examCost: 575, cePools: ['isaca-cpe'], ceRequired: 120, ceCategories: { 'general': 20 }, satisfies: [] },
  { id: 'isaca-cgeit', body: 'ISACA', name: 'CGEIT', cycleYears: 3, examCost: 575, cePools: ['isaca-cpe'], ceRequired: 120, ceCategories: {}, satisfies: [] },
  { id: 'isaca-cdpse', body: 'ISACA', name: 'CDPSE', cycleYears: 3, examCost: 575, cePools: ['isaca-cpe'], ceRequired: 60, ceCategories: {}, satisfies: [] },
  // EC-Council
  { id: 'ec-ceh', body: 'EC-Council', name: 'CEH', cycleYears: 3, examCost: 550, cePools: ['ec-ece'], ceRequired: 120, ceCategories: {}, satisfies: [] },
  { id: 'ec-cpent', body: 'EC-Council', name: 'CPENT', cycleYears: 3, examCost: 999, cePools: ['ec-ece'], ceRequired: 120, ceCategories: {}, satisfies: ['ec-ceh'] },
  { id: 'ec-chfi', body: 'EC-Council', name: 'CHFI', cycleYears: 3, examCost: 550, cePools: ['ec-ece'], ceRequired: 120, ceCategories: {}, satisfies: [] },
  { id: 'ec-ecsa', body: 'EC-Council', name: 'ECSA', cycleYears: 3, examCost: 550, cePools: ['ec-ece'], ceRequired: 120, ceCategories: {}, satisfies: ['ec-ceh'] },
  // GIAC/SANS
  { id: 'giac-gsec', body: 'GIAC', name: 'GSEC', cycleYears: 4, examCost: 849, cePools: ['giac-cpe'], ceRequired: 36, ceCategories: {}, satisfies: [] },
  { id: 'giac-gcih', body: 'GIAC', name: 'GCIH', cycleYears: 4, examCost: 849, cePools: ['giac-cpe'], ceRequired: 36, ceCategories: {}, satisfies: [] },
  { id: 'giac-gpen', body: 'GIAC', name: 'GPEN', cycleYears: 4, examCost: 849, cePools: ['giac-cpe'], ceRequired: 36, ceCategories: {}, satisfies: [] },
  { id: 'giac-gwapt', body: 'GIAC', name: 'GWAPT', cycleYears: 4, examCost: 849, cePools: ['giac-cpe'], ceRequired: 36, ceCategories: {}, satisfies: [] },
  { id: 'giac-gcia', body: 'GIAC', name: 'GCIA', cycleYears: 4, examCost: 849, cePools: ['giac-cpe'], ceRequired: 36, ceCategories: {}, satisfies: [] },
  { id: 'giac-gcfe', body: 'GIAC', name: 'GCFE', cycleYears: 4, examCost: 849, cePools: ['giac-cpe'], ceRequired: 36, ceCategories: {}, satisfies: [] },
  // AWS
  { id: 'aws-cp', body: 'AWS', name: 'Cloud Practitioner', cycleYears: 3, examCost: 100, cePools: [], ceRequired: 0, ceCategories: {}, satisfies: [], examOnly: true },
  { id: 'aws-saa', body: 'AWS', name: 'Solutions Architect Associate', cycleYears: 3, examCost: 300, cePools: [], ceRequired: 0, ceCategories: {}, satisfies: ['aws-cp'], examOnly: true },
  { id: 'aws-saap', body: 'AWS', name: 'Solutions Architect Professional', cycleYears: 3, examCost: 300, cePools: [], ceRequired: 0, ceCategories: {}, satisfies: ['aws-saa', 'aws-cp'], examOnly: true },
  { id: 'aws-dev', body: 'AWS', name: 'Developer Associate', cycleYears: 3, examCost: 300, cePools: [], ceRequired: 0, ceCategories: {}, satisfies: ['aws-cp'], examOnly: true },
  { id: 'aws-sysops', body: 'AWS', name: 'SysOps Administrator', cycleYears: 3, examCost: 300, cePools: [], ceRequired: 0, ceCategories: {}, satisfies: ['aws-cp'], examOnly: true },
  { id: 'aws-sec', body: 'AWS', name: 'Security Specialty', cycleYears: 3, examCost: 300, cePools: [], ceRequired: 0, ceCategories: {}, satisfies: [], examOnly: true },
  { id: 'aws-dop', body: 'AWS', name: 'DevOps Engineer Professional', cycleYears: 3, examCost: 300, cePools: [], ceRequired: 0, ceCategories: {}, satisfies: ['aws-dev', 'aws-sysops', 'aws-cp'], examOnly: true },
  // Azure
  { id: 'azure-fundamentals', body: 'Microsoft Azure', name: 'AZ-900 Fundamentals', cycleYears: 999, examCost: 165, cePools: [], ceRequired: 0, ceCategories: {}, satisfies: [], noExpiry: true },
  { id: 'azure-admin', body: 'Microsoft Azure', name: 'AZ-104 Administrator', cycleYears: 1, examCost: 165, cePools: [], ceRequired: 0, ceCategories: {}, satisfies: [], examOnly: true },
  { id: 'azure-dev', body: 'Microsoft Azure', name: 'AZ-204 Developer', cycleYears: 1, examCost: 165, cePools: [], ceRequired: 0, ceCategories: {}, satisfies: [], examOnly: true },
  { id: 'azure-secops', body: 'Microsoft Azure', name: 'SC-200 Security Operations', cycleYears: 1, examCost: 165, cePools: [], ceRequired: 0, ceCategories: {}, satisfies: [], examOnly: true },
  { id: 'azure-identity', body: 'Microsoft Azure', name: 'SC-300 Identity', cycleYears: 1, examCost: 165, cePools: [], ceRequired: 0, ceCategories: {}, satisfies: [], examOnly: true },
  { id: 'azure-sentinel', body: 'Microsoft Azure', name: 'SC-200 Sentinel/SIEM', cycleYears: 1, examCost: 165, cePools: [], ceRequired: 0, ceCategories: {}, satisfies: [], examOnly: true },
  // GCP
  { id: 'gcp-ace', body: 'Google Cloud', name: 'Associate Cloud Engineer', cycleYears: 2, examCost: 200, cePools: [], ceRequired: 0, ceCategories: {}, satisfies: [], examOnly: true },
  { id: 'gcp-pca', body: 'Google Cloud', name: 'Professional Cloud Architect', cycleYears: 2, examCost: 200, cePools: [], ceRequired: 0, ceCategories: {}, satisfies: ['gcp-ace'], examOnly: true },
  { id: 'gcp-sec', body: 'Google Cloud', name: 'Professional Cloud Security Engineer', cycleYears: 2, examCost: 200, cePools: [], ceRequired: 0, ceCategories: {}, satisfies: [], examOnly: true },
  // Offensive Security
  { id: 'offsec-oscp', body: 'OffSec', name: 'OSCP', cycleYears: 999, examCost: 1499, cePools: [], ceRequired: 0, ceCategories: {}, satisfies: [], noExpiry: true },
  { id: 'offsec-osep', body: 'OffSec', name: 'OSEP', cycleYears: 999, examCost: 1499, cePools: [], ceRequired: 0, ceCategories: {}, satisfies: ['offsec-oscp'], noExpiry: true },
  { id: 'offsec-oswp', body: 'OffSec', name: 'OSWP', cycleYears: 999, examCost: 999, cePools: [], ceRequired: 0, ceCategories: {}, satisfies: [], noExpiry: true },
  // ITIL
  { id: 'itil-foundation', body: 'ITIL/PeopleCert', name: 'ITIL 4 Foundation', cycleYears: 999, examCost: 385, cePools: [], ceRequired: 0, ceCategories: {}, satisfies: [], noExpiry: true },
  // PMI
  { id: 'pmi-pmp', body: 'PMI', name: 'PMP', cycleYears: 3, examCost: 555, cePools: ['pmi-pdu'], ceRequired: 60, ceCategories: { 'technical': 8, 'leadership': 8, 'strategic': 8 }, satisfies: [] },
  { id: 'pmi-capm', body: 'PMI', name: 'CAPM', cycleYears: 5, examCost: 300, cePools: [], ceRequired: 0, ceCategories: {}, satisfies: [], examOnly: true },
  // CIW
  { id: 'cloud-practitioner', body: 'CCSP/Cloud', name: 'CCSP (ISC¬≤ Cloud)', cycleYears: 3, examCost: 599, cePools: ['isc2-cpe'], ceRequired: 90, ceCategories: {}, satisfies: [] },
  // Cisco
  { id: 'cisco-ccna', body: 'Cisco', name: 'CCNA', cycleYears: 3, examCost: 330, cePools: [], ceRequired: 0, ceCategories: {}, satisfies: [], examOnly: true },
  { id: 'cisco-ccnp-ent', body: 'Cisco', name: 'CCNP Enterprise', cycleYears: 3, examCost: 750, cePools: [], ceRequired: 0, ceCategories: {}, satisfies: ['cisco-ccna'], examOnly: true },
  { id: 'cisco-ccnp-sec', body: 'Cisco', name: 'CCNP Security', cycleYears: 3, examCost: 750, cePools: [], ceRequired: 0, ceCategories: {}, satisfies: ['cisco-ccna'], examOnly: true },
  { id: 'cisco-ccie', body: 'Cisco', name: 'CCIE', cycleYears: 3, examCost: 1600, cePools: [], ceRequired: 0, ceCategories: {}, satisfies: ['cisco-ccnp-ent', 'cisco-ccnp-sec', 'cisco-ccna'], examOnly: true },
];

// CE Activity catalog ‚Äî activities that cover multiple pools
const ACTIVITY_CATALOG = [
  { id: 'sans-course', name: 'SANS Training Course (online)', cost: 5000, grants: { 'giac-cpe': 40, 'isc2-cpe': 40, 'isaca-cpe': 40, 'comptia-sec': 60, 'comptia-advanced': 60 }, description: 'Counts across most major bodies' },
  { id: 'sans-webcast', name: 'SANS Webcast (free, per event)', cost: 0, grants: { 'giac-cpe': 1, 'isc2-cpe': 1, 'isaca-cpe': 1, 'comptia-sec': 1, 'comptia-advanced': 1 }, description: 'Free CPE ‚Äî attend multiple' },
  { id: 'cybrary-course', name: 'Cybrary Course', cost: 99, grants: { 'isc2-cpe': 20, 'comptia-core': 20, 'comptia-sec': 20, 'ec-ece': 20 }, description: 'Annual subscription includes many courses' },
  { id: 'pluralsight', name: 'Pluralsight Subscription (annual)', cost: 299, grants: { 'isc2-cpe': 60, 'comptia-core': 30, 'comptia-sec': 50, 'isaca-cpe': 30 }, description: 'Broad coverage, high volume' },
  { id: 'linkedin-learning', name: 'LinkedIn Learning (annual)', cost: 240, grants: { 'isc2-cpe': 40, 'comptia-core': 20, 'isaca-cpe': 20, 'pmi-pdu': 20 }, description: 'Wide coverage, lower CE credit rates' },
  { id: 'oreilly', name: "O'Reilly Learning (annual)", cost: 499, grants: { 'isc2-cpe': 50, 'comptia-core': 40, 'comptia-sec': 40, 'isaca-cpe': 40, 'giac-cpe': 30 }, description: 'High-quality technical content' },
  { id: 'bsides-conf', name: 'BSides Conference Attendance', cost: 25, grants: { 'isc2-cpe': 8, 'isaca-cpe': 8, 'comptia-sec': 8, 'ec-ece': 8, 'giac-cpe': 8 }, description: 'Community security conference' },
  { id: 'defcon', name: 'DEF CON Attendance', cost: 440, grants: { 'isc2-cpe': 24, 'isaca-cpe': 16, 'comptia-sec': 24, 'comptia-advanced': 24, 'ec-ece': 24, 'giac-cpe': 24 }, description: 'Premier hacking conference, 3 days' },
  { id: 'rsaconf', name: 'RSA Conference Attendance', cost: 2200, grants: { 'isc2-cpe': 40, 'isaca-cpe': 40, 'comptia-sec': 40, 'comptia-advanced': 40, 'ec-ece': 40, 'pmi-pdu': 20 }, description: 'Major enterprise security conference' },
  { id: 'volunteer-chapter', name: 'ISC¬≤/ISACA Chapter Volunteering (annual)', cost: 0, grants: { 'isc2-cpe': 20, 'isaca-cpe': 20 }, description: 'Professional service CPE' },
  { id: 'blog-writing', name: 'Technical Blog / Article Writing', cost: 0, grants: { 'isc2-cpe': 10, 'isaca-cpe': 10, 'comptia-sec': 10, 'giac-cpe': 5 }, description: 'Original contribution credits' },
  { id: 'htb-academy', name: 'HackTheBox Academy (annual)', cost: 490, grants: { 'comptia-sec': 60, 'comptia-advanced': 75, 'ec-ece': 60, 'giac-cpe': 36 }, description: 'Practical offensive/defensive security' },
  { id: 'thm', name: 'TryHackMe Pro (annual)', cost: 140, grants: { 'comptia-core': 30, 'comptia-sec': 50, 'ec-ece': 40, 'giac-cpe': 20 }, description: 'Guided security training rooms' },
  { id: 'udemy-course', name: 'Udemy Course Bundle', cost: 30, grants: { 'isc2-cpe': 15, 'comptia-core': 15, 'comptia-sec': 15, 'pmi-pdu': 10 }, description: 'Low-cost, moderate CPE value' },
  { id: 'nist-webinar', name: 'NIST/CISA Webinar (per event)', cost: 0, grants: { 'isc2-cpe': 2, 'isaca-cpe': 2, 'comptia-sec': 2 }, description: 'Government-hosted free training' },
  { id: 'comptia-ceu-training', name: 'CompTIA CertMaster Learn CE', cost: 299, grants: { 'comptia-core': 30, 'comptia-sec': 50, 'comptia-net': 30, 'comptia-advanced': 75 }, description: 'Official CompTIA CE platform' },
  { id: 'aws-training', name: 'AWS Training & Certification (annual)', cost: 299, grants: { 'isc2-cpe': 20, 'isaca-cpe': 15 }, description: 'AWS official training, limited CPE for non-AWS certs' },
  { id: 'isaca-conference', name: 'ISACA Conference Attendance', cost: 1200, grants: { 'isaca-cpe': 24, 'isc2-cpe': 16 }, description: 'ISACA-specific CPE, high value for CISM/CISA/CRISC' },
  { id: 'ec-aspen', name: 'EC-Council Aspen (annual)', cost: 399, grants: { 'ec-ece': 120 }, description: 'EC-Council official CPE portal' },
  { id: 'pmi-pdu-course', name: 'PMI-Aligned Project Management Course', cost: 200, grants: { 'pmi-pdu': 40 }, description: 'PMI-specific PDU training' },
];

// ============================================================
// OPTIMIZER ENGINE
// ============================================================
function getStatus(cert) {
  if (cert.noExpiry) return 'current';
  if (!cert.expiryDate) return 'unknown';
  const now = new Date();
  const exp = new Date(cert.expiryDate);
  const daysLeft = Math.floor((exp - now) / 86400000);
  if (daysLeft < 0) return 'expired';
  if (daysLeft < 180) return 'expiring';
  return 'current';
}

function getDaysLeft(cert) {
  if (!cert.expiryDate) return null;
  const now = new Date();
  const exp = new Date(cert.expiryDate);
  return Math.floor((exp - now) / 86400000);
}

function greedyOptimize(userCerts) {
  // Find certs that need recertification
  const needRecert = userCerts.filter(uc => {
    const def = CERT_DB.find(d => d.id === uc.defId);
    if (!def) return false;
    if (def.noExpiry) return false;
    if (!uc.expiryDate) return false;
    const status = getStatus(uc);
    return status === 'expired' || status === 'expiring';
  });

  if (needRecert.length === 0) return { steps: [], totalCost: 0, coveredCerts: [] };

  // Build requirement map: which certs need what CE credits by pool
  const requirements = {};
  const examOnlyNeeds = [];

  for (const uc of needRecert) {
    const def = CERT_DB.find(d => d.id === uc.defId);
    if (!def) continue;

    if (def.examOnly || def.cePools.length === 0) {
      // Exam is the only option
      examOnlyNeeds.push({ uc, def, cost: def.examCost });
      continue;
    }

    // Check if CE path is viable or if exam is cheaper
    // CE path: need to cover all pools for this cert
    const ceEarned = uc.ceEarned || 0;
    const ceStillNeeded = Math.max(0, def.ceRequired - ceEarned);

    if (ceStillNeeded > 0) {
      for (const pool of def.cePools) {
        if (!requirements[pool]) requirements[pool] = { certs: [], creditsNeeded: 0 };
        requirements[pool].certs.push(uc.defId);
        requirements[pool].creditsNeeded = Math.max(requirements[pool].creditsNeeded, ceStillNeeded);
      }
    }
  }

  const steps = [];
  const covered = { ...requirements }; // track remaining credits needed
  const selectedActivities = [];

  // Greedy: iterate until all pools satisfied
  let iterations = 0;
  while (Object.values(covered).some(r => r.creditsNeeded > 0) && iterations < 50) {
    iterations++;
    let bestActivity = null;
    let bestScore = -1;

    for (const activity of ACTIVITY_CATALOG) {
      if (selectedActivities.includes(activity.id)) continue;

      let coverageValue = 0;
      let costsPerCoverage = 0;

      for (const [pool, grants] of Object.entries(activity.grants)) {
        if (covered[pool] && covered[pool].creditsNeeded > 0) {
          const contribution = Math.min(grants, covered[pool].creditsNeeded);
          coverageValue += contribution;
        }
      }

      if (coverageValue === 0) continue;

      // Score = coverage / cost (free activities get bonus)
      const effectiveCost = Math.max(activity.cost, 1);
      const score = coverageValue / effectiveCost;

      if (score > bestScore) {
        bestScore = score;
        bestActivity = activity;
      }
    }

    if (!bestActivity) break;

    // Apply activity
    selectedActivities.push(bestActivity.id);
    const coveredCerts = new Set();

    for (const [pool, grants] of Object.entries(bestActivity.grants)) {
      if (covered[pool]) {
        covered[pool].creditsNeeded = Math.max(0, covered[pool].creditsNeeded - grants);
        if (covered[pool].creditsNeeded === 0) {
          covered[pool].certs.forEach(c => coveredCerts.add(c));
        }
      }
    }

    steps.push({
      type: 'ce',
      activity: bestActivity,
      coveredPools: Object.keys(bestActivity.grants).filter(p => requirements[p]),
      coveredCerts: [...coveredCerts],
    });
  }

  // Check if exam is cheaper than remaining CE for any cert
  const finalSteps = [];
  
  // Add CE steps
  finalSteps.push(...steps);

  // Add exam-only needs
  for (const need of examOnlyNeeds) {
    finalSteps.push({
      type: 'exam',
      cert: need.def,
      coveredCerts: [need.uc.defId, ...need.def.satisfies],
      activity: {
        id: `exam-${need.def.id}`,
        name: `${need.def.name} Exam Retake`,
        cost: need.examCost || need.def.examCost,
        description: `Official ${need.def.body} exam ‚Äî covers ${need.def.name}${need.def.satisfies.length ? ' and satisfies lower-tier certs' : ''}`,
      }
    });
  }

  // Sort: free first, then cheapest
  finalSteps.sort((a, b) => a.activity.cost - b.activity.cost);

  const totalCost = finalSteps.reduce((s, step) => s + step.activity.cost, 0);

  return {
    steps: finalSteps,
    totalCost,
    needsRecert: needRecert.length,
    examOnlyCount: examOnlyNeeds.length,
  };
}

// ============================================================
// COMPONENTS
// ============================================================

function StatusBadge({ status }) {
  const labels = { current: 'CURRENT', expiring: 'EXPIRING', expired: 'EXPIRED', unknown: 'NO DATE' };
  return <span className={`status-badge ${status}`}>{labels[status] || status}</span>;
}

function AddCertModal({ onClose, onAdd }) {
  const [defId, setDefId] = useState('');
  const [expiryDate, setExpiryDate] = useState('');
  const [ceEarned, setCeEarned] = useState('');
  const [notes, setNotes] = useState('');

  const selectedDef = CERT_DB.find(d => d.id === defId);
  const bodies = [...new Set(CERT_DB.map(d => d.body))].sort();

  const handleAdd = () => {
    if (!defId) return;
    onAdd({ defId, expiryDate, ceEarned: parseInt(ceEarned) || 0, notes, id: Date.now().toString() });
    onClose();
  };

  const grouped = {};
  for (const b of bodies) {
    grouped[b] = CERT_DB.filter(d => d.body === b);
  }

  return (
    <div className="modal-overlay" onClick={onClose}>
      <div className="modal" onClick={e => e.stopPropagation()}>
        <div className="modal-title">ADD CERTIFICATION</div>
        <div className="form-group">
          <label className="form-label">Certification</label>
          <select className="form-select" value={defId} onChange={e => setDefId(e.target.value)}>
            <option value="">‚Äî Select ‚Äî</option>
            {bodies.map(b => (
              <optgroup label={b} key={b}>
                {CERT_DB.filter(d => d.body === b).map(d => (
                  <option key={d.id} value={d.id}>{d.name}</option>
                ))}
              </optgroup>
            ))}
          </select>
        </div>
        {selectedDef && (
          <div className="info-banner" style={{marginBottom: 14}}>
            <span className="text-accent">{selectedDef.body} {selectedDef.name}</span>
            {selectedDef.noExpiry ? ' ‚Äî Does not expire' : ` ‚Äî ${selectedDef.cycleYears}-year cycle`}
            {selectedDef.examOnly ? ' ‚Äî Exam-only recertification' : ` ‚Äî ${selectedDef.ceRequired} CE credits to recertify`}
            <br/>Exam cost: <span className="text-green">${selectedDef.examCost}</span>
          </div>
        )}
        {selectedDef && !selectedDef.noExpiry && (
          <div className="form-group">
            <label className="form-label">Expiry Date</label>
            <input type="date" className="form-input" value={expiryDate} onChange={e => setExpiryDate(e.target.value)} />
          </div>
        )}
        {selectedDef && !selectedDef.examOnly && selectedDef?.ceRequired > 0 && (
          <div className="form-group">
            <label className="form-label">CE Credits Already Earned ({selectedDef.ceRequired} required)</label>
            <input type="number" className="form-input" placeholder="0" value={ceEarned} onChange={e => setCeEarned(e.target.value)} min="0" max={selectedDef.ceRequired} />
          </div>
        )}
        <div className="form-group">
          <label className="form-label">Notes (optional)</label>
          <input type="text" className="form-input" placeholder="e.g. renewal strategy, priority..." value={notes} onChange={e => setNotes(e.target.value)} />
        </div>
        <div className="modal-actions">
          <button className="btn btn-ghost" onClick={onClose}>Cancel</button>
          <button className="btn btn-primary" onClick={handleAdd} disabled={!defId}>Add Cert</button>
        </div>
      </div>
    </div>
  );
}

function EditCertModal({ cert, def, onClose, onSave, onDelete }) {
  const [expiryDate, setExpiryDate] = useState(cert.expiryDate || '');
  const [ceEarned, setCeEarned] = useState(cert.ceEarned || 0);
  const [notes, setNotes] = useState(cert.notes || '');

  return (
    <div className="modal-overlay" onClick={onClose}>
      <div className="modal" onClick={e => e.stopPropagation()}>
        <div className="modal-title">EDIT ‚Äî {def.body} {def.name}</div>
        {!def.noExpiry && (
          <div className="form-group">
            <label className="form-label">Expiry Date</label>
            <input type="date" className="form-input" value={expiryDate} onChange={e => setExpiryDate(e.target.value)} />
          </div>
        )}
        {!def.examOnly && def.ceRequired > 0 && (
          <div className="form-group">
            <label className="form-label">CE Credits Earned ({def.ceRequired} required)</label>
            <input type="number" className="form-input" value={ceEarned} onChange={e => setCeEarned(parseInt(e.target.value) || 0)} min="0" max={def.ceRequired} />
          </div>
        )}
        <div className="form-group">
          <label className="form-label">Notes</label>
          <input type="text" className="form-input" value={notes} onChange={e => setNotes(e.target.value)} />
        </div>
        <div className="modal-actions">
          <button className="btn btn-danger btn-sm" onClick={() => { onDelete(cert.id); onClose(); }}>Delete</button>
          <div style={{flex:1}} />
          <button className="btn btn-ghost" onClick={onClose}>Cancel</button>
          <button className="btn btn-primary" onClick={() => { onSave({ ...cert, expiryDate, ceEarned, notes }); onClose(); }}>Save</button>
        </div>
      </div>
    </div>
  );
}

function PortfolioTab({ userCerts, setUserCerts }) {
  const [showAdd, setShowAdd] = useState(false);
  const [editCert, setEditCert] = useState(null);

  const addCert = (c) => setUserCerts(prev => [...prev, c]);
  const saveCert = (c) => setUserCerts(prev => prev.map(uc => uc.id === c.id ? c : uc));
  const deleteCert = (id) => setUserCerts(prev => prev.filter(uc => uc.id !== id));

  const editDef = editCert ? CERT_DB.find(d => d.id === editCert.defId) : null;

  return (
    <div>
      <div className="section-header">
        <span className="section-title">Your Certifications ({userCerts.length})</span>
        <button className="btn btn-primary btn-sm" onClick={() => setShowAdd(true)}>+ Add Cert</button>
      </div>

      {userCerts.length === 0 ? (
        <div className="empty">
          <div className="empty-icon">üèÖ</div>
          <div className="empty-text">No certifications added yet.<br/>Click "Add Cert" to populate your portfolio.</div>
        </div>
      ) : (
        <div className="cert-grid">
          {userCerts.map(uc => {
            const def = CERT_DB.find(d => d.id === uc.defId);
            if (!def) return null;
            const status = getStatus(uc);
            const daysLeft = getDaysLeft(uc);
            const ceProgress = def.ceRequired > 0 ? Math.min(100, Math.round((uc.ceEarned / def.ceRequired) * 100)) : null;

            return (
              <div key={uc.id} className={`cert-card status-${status}`}>
                <div style={{display:'flex', justifyContent:'space-between', alignItems:'flex-start', marginBottom: 8}}>
                  <div>
                    <div className="cert-name">{def.name}</div>
                    <div className="cert-body">{def.body}</div>
                  </div>
                  <StatusBadge status={status} />
                </div>
                <div className="cert-meta">
                  {uc.expiryDate && !def.noExpiry && (
                    <div className="cert-meta-row">
                      <span className="cert-meta-label">EXPIRES</span>
                      <span className="cert-meta-value" style={{color: status==='expired'?'var(--red)':status==='expiring'?'var(--yellow)':'var(--text2)'}}>
                        {uc.expiryDate} {daysLeft !== null && <span>({daysLeft > 0 ? `${daysLeft}d` : 'PAST'})</span>}
                      </span>
                    </div>
                  )}
                  {def.noExpiry && <div className="cert-meta-row"><span className="cert-meta-label">EXPIRY</span><span className="cert-meta-value text-green">NONE</span></div>}
                  {def.ceRequired > 0 && !def.examOnly && (
                    <div className="cert-meta-row">
                      <span className="cert-meta-label">CE PROGRESS</span>
                      <span className="cert-meta-value">{uc.ceEarned || 0}/{def.ceRequired} hrs</span>
                    </div>
                  )}
                  {def.examOnly && <div className="cert-meta-row"><span className="cert-meta-label">RECERT</span><span className="cert-meta-value">Exam only</span></div>}
                  {def.examCost > 0 && <div className="cert-meta-row"><span className="cert-meta-label">EXAM COST</span><span className="cert-meta-value">${def.examCost}</span></div>}
                  {uc.notes && <div className="cert-meta-row"><span className="cert-meta-label">NOTE</span><span className="cert-meta-value" style={{maxWidth:140, overflow:'hidden', textOverflow:'ellipsis', whiteSpace:'nowrap'}}>{uc.notes}</span></div>}
                </div>
                {ceProgress !== null && (
                  <div style={{marginTop: 10}}>
                    <div style={{height: 4, background: 'var(--surface2)', borderRadius: 2, overflow: 'hidden'}}>
                      <div style={{height:'100%', width:`${ceProgress}%`, background: ceProgress === 100 ? 'var(--green)' : 'var(--accent)', borderRadius: 2, transition: 'width 0.3s'}} />
                    </div>
                  </div>
                )}
                <div className="cert-actions">
                  <button className="btn btn-ghost btn-sm" onClick={() => setEditCert(uc)}>Edit</button>
                </div>
              </div>
            );
          })}
        </div>
      )}

      {showAdd && <AddCertModal onClose={() => setShowAdd(false)} onAdd={addCert} />}
      {editCert && editDef && (
        <EditCertModal cert={editCert} def={editDef} onClose={() => setEditCert(null)} onSave={saveCert} onDelete={deleteCert} />
      )}
    </div>
  );
}

function TimelineTab({ userCerts }) {
  if (userCerts.length === 0) {
    return <div className="empty"><div className="empty-icon">üìÖ</div><div className="empty-text">No certs in portfolio yet.</div></div>;
  }

  const sorted = [...userCerts]
    .filter(uc => {
      const def = CERT_DB.find(d => d.id === uc.defId);
      return def && !def.noExpiry && uc.expiryDate;
    })
    .sort((a, b) => new Date(a.expiryDate) - new Date(b.expiryDate));

  const now = new Date();
  const maxDate = new Date(now);
  maxDate.setFullYear(maxDate.getFullYear() + 5);
  const totalMs = maxDate - now;

  return (
    <div>
      <div className="section-header">
        <span className="section-title">Expiry Timeline</span>
        <span className="text-xs text-dim text-mono">Next 5 years</span>
      </div>
      <div className="card">
        <div style={{display:'flex', gap:8, marginBottom:12, flexWrap:'wrap'}}>
          <span className="text-xs text-mono" style={{display:'flex',alignItems:'center',gap:4}}><span style={{width:8,height:8,borderRadius:2,background:'var(--green)',display:'inline-block'}}/>Current</span>
          <span className="text-xs text-mono" style={{display:'flex',alignItems:'center',gap:4}}><span style={{width:8,height:8,borderRadius:2,background:'var(--yellow)',display:'inline-block'}}/>Expiring &lt;6mo</span>
          <span className="text-xs text-mono" style={{display:'flex',alignItems:'center',gap:4}}><span style={{width:8,height:8,borderRadius:2,background:'var(--red)',display:'inline-block'}}/>Expired</span>
        </div>
        <div className="timeline">
          {sorted.map(uc => {
            const def = CERT_DB.find(d => d.id === uc.defId);
            const status = getStatus(uc);
            const exp = new Date(uc.expiryDate);
            const daysLeft = getDaysLeft(uc);
            let barWidth = 0;
            let barColor = 'var(--green)';
            if (daysLeft > 0) {
              barWidth = Math.min(100, ((exp - now) / totalMs) * 100);
            }
            if (status === 'expiring') barColor = 'var(--yellow)';
            if (status === 'expired') barColor = 'var(--red)';

            return (
              <div key={uc.id} className="timeline-row">
                <div className="timeline-label">{def?.name}</div>
                <div className="timeline-bar-wrap">
                  <div className="timeline-bar" style={{width: `${Math.max(barWidth, 2)}%`, background: barColor}} />
                </div>
                <div className="timeline-days" style={{color: status==='expired'?'var(--red)':status==='expiring'?'var(--yellow)':'var(--text3)'}}>
                  {daysLeft === null ? '‚Äî' : daysLeft > 0 ? `${daysLeft}d` : 'EXPIRED'}
                </div>
              </div>
            );
          })}
        </div>
        {userCerts.filter(uc => CERT_DB.find(d => d.id === uc.defId)?.noExpiry).length > 0 && (
          <div style={{marginTop:16, paddingTop:12, borderTop:'1px solid var(--border)'}}>
            <div className="text-xs text-dim text-mono" style={{marginBottom:8}}>NON-EXPIRING CERTS</div>
            <div style={{display:'flex', flexWrap:'wrap', gap:6}}>
              {userCerts.filter(uc => CERT_DB.find(d => d.id === uc.defId)?.noExpiry).map(uc => {
                const def = CERT_DB.find(d => d.id === uc.defId);
                return <span key={uc.id} className="opt-tag">{def?.name}</span>;
              })}
            </div>
          </div>
        )}
      </div>
    </div>
  );
}

function OptimizerTab({ userCerts }) {
  const result = useMemo(() => greedyOptimize(userCerts), [userCerts]);

  if (userCerts.length === 0) {
    return <div className="empty"><div className="empty-icon">üîç</div><div className="empty-text">Add certifications to your portfolio to run the optimizer.</div></div>;
  }

  if (result.steps.length === 0) {
    return (
      <div>
        <div className="summary-box">
          <div className="summary-item"><div className="summary-value text-green">‚úì</div><div className="summary-label">Status</div></div>
          <div className="summary-item"><div className="summary-value text-green">$0</div><div className="summary-label">Additional Cost</div></div>
          <div className="summary-item"><div className="summary-value">{userCerts.length}</div><div className="summary-label">Total Certs</div></div>
        </div>
        <div className="info-banner">All certs are current. No recertification actions required.</div>
      </div>
    );
  }

  return (
    <div>
      <div className="summary-box">
        <div className="summary-item">
          <div className="summary-value text-accent">${result.totalCost.toLocaleString()}</div>
          <div className="summary-label">Total Cost</div>
        </div>
        <div className="summary-item">
          <div className="summary-value">{result.steps.length}</div>
          <div className="summary-label">Actions</div>
        </div>
        <div className="summary-item">
          <div className="summary-value text-yellow">{result.needsRecert}</div>
          <div className="summary-label">Need Recert</div>
        </div>
        <div className="summary-item">
          <div className="summary-value text-dim">{result.steps.filter(s=>s.activity.cost===0).length}</div>
          <div className="summary-label">Free Steps</div>
        </div>
      </div>
      <div className="info-banner">
        Actions ordered by cost-effectiveness (greedy). Free activities first ‚Äî complete those before spending. Activities covering multiple cert bodies provide highest ROI.
      </div>
      <div className="section-header">
        <span className="section-title">Optimized Action Plan</span>
      </div>
      {result.steps.map((step, i) => {
        const coveredNames = step.coveredCerts?.map(cid => CERT_DB.find(d=>d.id===cid)?.name).filter(Boolean) || [];
        const coveredPools = step.coveredPools || [];
        return (
          <div key={i} className="opt-step">
            <div className="opt-step-num">{i+1}</div>
            <div className="opt-step-body">
              <div className="opt-step-title">{step.activity.name}</div>
              <div className="opt-step-desc">{step.activity.description}</div>
              <div className="opt-step-meta">
                <span className="opt-step-cost">{step.activity.cost === 0 ? 'FREE' : `$${step.activity.cost.toLocaleString()}`}</span>
                {coveredPools.length > 0 && (
                  <span className="opt-step-covers">Satisfies: {coveredPools.join(', ')}</span>
                )}
              </div>
              {coveredNames.length > 0 && (
                <div style={{marginTop:6}}>
                  {coveredNames.map(n => <span key={n} className="opt-tag">{n}</span>)}
                </div>
              )}
            </div>
          </div>
        );
      })}
    </div>
  );
}

function DataTab({ userCerts, setUserCerts }) {
  const exportJSON = () => {
    const data = { exported: new Date().toISOString(), version: 1, certs: userCerts };
    const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'certpath-portfolio.json'; a.click();
    URL.revokeObjectURL(url);
  };

  const exportCSV = () => {
    const rows = [['id', 'certId', 'certName', 'body', 'expiryDate', 'ceEarned', 'ceRequired', 'status', 'daysLeft', 'notes']];
    for (const uc of userCerts) {
      const def = CERT_DB.find(d => d.id === uc.defId);
      if (!def) continue;
      rows.push([
        uc.id, uc.defId, def.name, def.body, uc.expiryDate || '', uc.ceEarned || 0,
        def.ceRequired, getStatus(uc), getDaysLeft(uc) ?? '', uc.notes || ''
      ]);
    }
    const csv = rows.map(r => r.join(',')).join('\n');
    const blob = new Blob([csv], { type: 'text/csv' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a'); a.href = url; a.download = 'certpath-portfolio.csv'; a.click();
    URL.revokeObjectURL(url);
  };

  const importJSON = (e) => {
    const file = e.target.files[0];
    if (!file) return;
    const reader = new FileReader();
    reader.onload = ev => {
      try {
        const data = JSON.parse(ev.target.result);
        if (data.certs && Array.isArray(data.certs)) {
          setUserCerts(data.certs);
        }
      } catch { alert('Invalid JSON file'); }
    };
    reader.readAsText(file);
    e.target.value = '';
  };

  const clearAll = () => {
    if (confirm('Delete all certs from portfolio?')) setUserCerts([]);
  };

  return (
    <div>
      <div className="section-title" style={{marginBottom:16}}>IMPORT / EXPORT</div>
      <div className="warn-banner">
        No data is stored on any server. All data lives in your browser's localStorage. Export regularly to avoid data loss.
      </div>
      <div className="grid-2" style={{marginBottom:16}}>
        <div className="card">
          <div className="card-title" style={{marginBottom:12}}>EXPORT</div>
          <div style={{display:'flex', flexDirection:'column', gap:8}}>
            <button className="btn btn-primary w-full" onClick={exportJSON}>Export JSON</button>
            <button className="btn btn-ghost w-full" onClick={exportCSV}>Export CSV</button>
          </div>
        </div>
        <div className="card">
          <div className="card-title" style={{marginBottom:12}}>IMPORT</div>
          <div style={{display:'flex', flexDirection:'column', gap:8}}>
            <label className="btn btn-ghost w-full" style={{cursor:'pointer', textAlign:'center', justifyContent:'center'}}>
              Import JSON
              <input type="file" accept=".json" onChange={importJSON} style={{display:'none'}} />
            </label>
            <button className="btn btn-danger w-full" onClick={clearAll}>Clear All Data</button>
          </div>
        </div>
      </div>
      <div className="card">
        <div className="card-title" style={{marginBottom:12}}>CERT KNOWLEDGE BASE</div>
        <div className="text-sm text-muted" style={{lineHeight:1.6, marginBottom:12}}>
          Hardcoded cert definitions: {CERT_DB.length} certs across {[...new Set(CERT_DB.map(d=>d.body))].length} vendors.
          CE pool mappings and cross-cert satisfaction relationships are encoded in the optimizer.
          Activity catalog: {ACTIVITY_CATALOG.length} training activities with multi-pool coverage data.
        </div>
        <div style={{display:'flex', flexWrap:'wrap', gap:6}}>
          {[...new Set(CERT_DB.map(d=>d.body))].sort().map(b => (
            <span key={b} className="opt-tag">{b} ({CERT_DB.filter(d=>d.body===b).length})</span>
          ))}
        </div>
      </div>
      <div className="card" style={{marginTop:16}}>
        <div className="card-title" style={{marginBottom:12}}>RAW DATA</div>
        <pre style={{fontFamily:'var(--mono)', fontSize:11, color:'var(--text2)', maxHeight:300, overflow:'auto', lineHeight:1.5}}>
          {JSON.stringify(userCerts, null, 2)}
        </pre>
      </div>
    </div>
  );
}

// ============================================================
// APP
// ============================================================
function App() {
  const [tab, setTab] = useState('portfolio');
  const [userCerts, setUserCerts] = useState(() => {
    try { return JSON.parse(localStorage.getItem('certpath-certs') || '[]'); }
    catch { return []; }
  });

  useEffect(() => {
    localStorage.setItem('certpath-certs', JSON.stringify(userCerts));
  }, [userCerts]);

  const stats = useMemo(() => {
    const defs = userCerts.map(uc => CERT_DB.find(d => d.id === uc.defId)).filter(Boolean);
    const statuses = userCerts.map(uc => getStatus(uc));
    return {
      total: userCerts.length,
      current: statuses.filter(s => s === 'current').length,
      expiring: statuses.filter(s => s === 'expiring').length,
      expired: statuses.filter(s => s === 'expired').length,
    };
  }, [userCerts]);

  const tabs = [
    { id: 'portfolio', label: 'PORTFOLIO' },
    { id: 'timeline', label: 'TIMELINE' },
    { id: 'optimizer', label: 'OPTIMIZER' },
    { id: 'data', label: 'DATA' },
  ];

  return (
    <div className="app">
      <div className="topbar">
        <div className="logo">CERT<span>PATH</span></div>
        <div className="tabs">
          {tabs.map(t => (
            <button key={t.id} className={`tab ${tab === t.id ? 'active' : ''}`} onClick={() => setTab(t.id)}>
              {t.label}
              {t.id === 'optimizer' && stats.expiring + stats.expired > 0 && (
                <span style={{marginLeft:4, background:'var(--yellow)', color:'#000', borderRadius:'50%', width:16, height:16, display:'inline-flex', alignItems:'center', justifyContent:'center', fontSize:10, fontWeight:700}}>
                  {stats.expiring + stats.expired}
                </span>
              )}
            </button>
          ))}
        </div>
        <div style={{display:'flex', gap:16, alignItems:'center'}}>
          <span className="text-mono text-xs text-dim">{stats.current}‚úì {stats.expiring > 0 && <span className="text-yellow">{stats.expiring}!</span>} {stats.expired > 0 && <span className="text-red">{stats.expired}‚úó</span>}</span>
        </div>
      </div>
      <div className="main">
        {tab === 'portfolio' && <PortfolioTab userCerts={userCerts} setUserCerts={setUserCerts} />}
        {tab === 'timeline' && <TimelineTab userCerts={userCerts} />}
        {tab === 'optimizer' && <OptimizerTab userCerts={userCerts} />}
        {tab === 'data' && <DataTab userCerts={userCerts} setUserCerts={setUserCerts} />}
      </div>
    </div>
  );
}

ReactDOM.createRoot(document.getElementById('root')).render(<App />);
</script>
</body>
</html>
